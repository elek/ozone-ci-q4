-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.349 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.288 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571636653938
datanodeUuid: "f8ffa3bb-fd93-4dec-a652-44d596aa0219"
writeChunk {
  blockID {
    containerID: 1571636653938
    localID: 1571636653941
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571636653941.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\330_\307x"
    }
  }
  data: "\330Q{\271\201\370\311\313\265\313*BPQY\310\225L\262\323.\266\361\215:;\337\367Z\203/F\334\373\f\336\362\337qj\211\024\242\311\360}{F*\260\333\257\316\027\375U\203\270PqvR\307\200\260l\207\375r\356\357\305\341\350\334\303x\261:\263jUU\f\276\271\334\241e\266Af\311\016\327loj\252_\206\317\037mQ\236\034\323\357c\017\277\213$\177\233\225(6A\034\213\266\207\2764/?\n\307\227*\364\257\254tc\254\317#B\272\032a\326z\017\313l\302\036\273\035Z<\265\342W,)\304\206\021vH\242\036\375\023w\220.\301\276\221\b*9}9^\343J\363\216\006\372\271gc\315\240\264V\346pP\023\200\322Q\351B\276\240)\'>w\"-P\017\"F\260\311\365\374\276\244j!PFS\0062\240N\215\032\202\337Z\361w\271\265\240D\212|y\"\234\306\024\335\241kP\222\to\311\272\036\372\303\017\023\240\362\000b\225\004\303\033\255\216*S\003s\302Rm\216\r\374\207\036QU\267\247\244G\266V87\311\022\225\257\256tbe\003\274W=\247-\032\227\205\364O\237\253\026\241\\vUj\377\004I\372]\312\a\004\030\337k\033\033\255j\f\205Z\206\335\206\225\221\315\322\247\vi8\303M\312 \000\350\371\272\341Y\200\246(\177\024\312\335\371\037\321\237\343\277\230\321\232g\\3\3504\2541NQ\206UX\033\347\231\0023\234\277vZ0\223\006zq-m\3718\305(0#PQ\257V\027\232\344\260O\032\v\305\017\350\271\272\027<]\365,f\232\355I$\311u\302\034\355\241\322\261-r\026\";\276\334\376\271u`\260\242^`\017p\362\022\332\021\343\273\234\360\273\352~\231)u\343#%\020\035a\257\r1\327\\1$\363iy\325M\v\254y\0044gw2\243\342\310\344\363 \r\254b\340a6\377\307,^5\204\203\246\376\252\246\220\226\'v\255\205\361\b\331\312\202A\257\005W\331\005[\205\233\355\210\243\030\a6I\244%\t\252\3057V\333\t\332\016\b\3103\306\027\006\221\341\342\332\022|\224C\216\276.\376\323Ean\323\232\263\315(\0008\033l\266 8\017\031\003\236U\nA\321\330\001\037)u/\023\311\204@\002M\203\024\3115\253V\226Y\332\201\320\006DD\317\375zUc\201\001\027h,\321^\324\312!K\257y\377 W>\354\320^`\253S\021\373+\342\b\257\262\r\275\002[\205\016\302&\352\"\276v87\231\202\177\321\375z\323M\273\377\371\020\' \323njc\345\300\263Y\366\213\302\313\377\375\351\221\375j\377>\236\r\210\313x\326|\a\215c\206\004zK\322)\271:\204\220\303+\005m%\035\022G6~\022\330\004f\033\266\351\345u\211\035\263\323\276\b\t#R\"/\347;W\333G\212N\\W\255\271C\263\347\216\360\325\367E\211\004]\263F\352\265\334R\240`\331*\211\270\034v\357\367B$\b\237>\270CxvQ\264\256\0348\335\362\233\372xX\353U=\213\350+\333\t\001o>[U\t\246<\020\215\341\215.\365\202\340t\305(\311\b\204%\226>\362~<\256\216\235T\203\371\271\262i\032\023g\322\244\256\231\r\273\371\365e9\317\371\375\031\200f\201\357\336\224\257\250\331dU\024\230\312K\232\356HV\264\215\005\310Zq8@\025\316\252\220\335PA\234\206\a\343:\373#%\214\027;\311U\035\246\311~y\215\257\272\016\201[E\304\006\232u\233\331\243a\322\0261\332\'\224+`\250\361\245fE\245\0325:Yf\005MZ\360\360:\b\233\337\300\237\215J\371\271\270\225\020\233,~4l\252(\226[.m}iou\231\347\361\320\006\365\022\256\2353\006C\"Xg\006\316\302\201\347V\233"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-0B7EF22BEC94->f8ffa3bb-fd93-4dec-a652-44d596aa0219@group-D1870B0E65FF, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571636653938
datanodeUuid: "f8ffa3bb-fd93-4dec-a652-44d596aa0219"
writeChunk {
  blockID {
    containerID: 1571636653938
    localID: 1571636653941
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571636653941.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\330_\307x"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-0B7EF22BEC94->f8ffa3bb-fd93-4dec-a652-44d596aa0219@group-D1870B0E65FF, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571636653938
datanodeUuid: "f8ffa3bb-fd93-4dec-a652-44d596aa0219"
writeChunk {
  blockID {
    containerID: 1571636653938
    localID: 1571636653941
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571636653941.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\330_\307x"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-0B7EF22BEC94->f8ffa3bb-fd93-4dec-a652-44d596aa0219 is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


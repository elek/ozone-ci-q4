-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.617 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.553 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571624423363
datanodeUuid: "772efb49-32f2-46fa-af6b-3b652275726d"
writeChunk {
  blockID {
    containerID: 1571624423363
    localID: 1571624423366
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571624423366.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\354\207\361-"
    }
  }
  data: "7\000\345\334\275&\277\t[\346\210&\022\223^\236\262\213s]\255\330\2318\333\360B\031\027\217\356\252?y\212K\344s\267\300\265{P\254?\265S\335\n\345P\002\2672\032\315\036M\'\315\272\313r\222z\263@\f\243\262\364%\203\246\233\201N\314\240K\271p\274\374\201\267\372\001\251\031\224\242\263\374\342ss$\245G\371m\036\236\024\fC\\\036\270\247|\334\035\223\2554\341\272\344\255\214\352\032\033\276I\312\370\373\000l\325\227\0030\236_U\344\237\032y;\026v\350o(\214\234\004\200dz;]\373\301D\235\250D\263\234\363\274\257\270\272m+X\006\033\204\n\352\345\032n\211r\343\036H\025;\271\005\352\f8l?F\247P\302\222\336\205L\372\342\374\206D\342-\227\376H\001\277y\243\267}\335\302\3722\027f\000\205B\302\224|j\361\360t\344j=\371F\313\2455F\253\245K\332\322\214\223f\340zF\036\005K\263d\257\226\036j\264\373\320\2073ck\200w\342\304\252\304\264\245\234\221\v`\251\317\257\374\027\270\"\n\335\241\310\316kP\016\236\\\022TT\277\231-\022)p\313\'yk\202cY\036\243\234\207f#\207\340\301\262k\240\321!$\000\360~\a`l&i\376\302\207{l\f{\306n\261\344`\016\273\222\367\334\255=ut\246x\371\362LjM=-n\217\207\201\373\274\313\311zP @\201z\000\246T\262\322\364\314\344;%\347\324Y\266\222\017\215\234d\331\275\247\356\251\355\025SF\260\326H\f\222\331\357\353:\233)\376\345\004\2540nU\2311\272\177\364i\366\343\361\206p\r\002\222\vRe\330dM\242\326\r\233<cQ\341\330?\362b\302\361\225 p\3577\030A\244\257\355\"\326\004\351@\232\334\273\205\000\360`\231\364\327\274J\370)\253\303jl\312}o\363\334u\254\256\231\356N\307\242\274F\245#\304\241JK\330HQx23\221\021\343\020\241O\024\364,\372\t\'\234\025\314\242\367\331\266\254CI\334\314\0261\301\304\031]-&\305\neDy\205\207+)\360\251\330\017\rq\004\333\274\341/^3\366\262o\333E\236\243\231\355\266\335 KS\244\304\244M\205rW\353TN\222H\307\321\351\227\250\255Gn\224\204LT\266\272rk\301ob\204\341j\337\3276\345[\bcK$\321\020n\354-\003\305\210\004\336^Je\3105\322\370\324+\242\005\336W\215\362P\344\n\316\244\231+p\245@>\242jOx\223R\r\256N\316\343\217\262\305\030\332\327\005q3\221\225\277TKMs\035\244\205\305\201t\313ap\331\352*\032\037q\177\206\\\024\020\261\021\214!\342\237\310\367(k\3116\320\317W\321\r\330\250\330\n\214S\301o%\336)`!t\201\363\023`\325\241\317s\304\250y\315\346\373Oc\r\244N\314\322\325.\360\323\250\206H\346\236\257\a\3541\211\036|\357\323I\217)-\232\250J\220[sws\3402\030\\)\325\202\304\304\0355\277\004g\257JN\rI#\240x\a\335WF\371\201\205\324\202\260\356 \246\261\2340\371~]\033\256\201L\034\240\204b\000\312\214\206\321G\320\321\256\a\026\354R/\3304\206\305\323\230\277\217\372\037\220\346\276\025\310\267\263\f\323\3274\334\240\v\316ns\371\234\212\346J\335\254\224\"8lSm5f\020U\240\333=\bVb\206\336\312a!\322Y\377K&.\216\333N#\356<\324\252q2F\225\323\224\342lb\340/i;\037\035\n1B\213E\335\217\232x\021Q\366 \305\266p\277q\224\026xP\366R\267\311+\330\017\370(\202\3271&z\203\343\276\207\237\000\273$O\373\3761\240\344%\2551\320x=\301Q,\204\370\214,\230\216\035\243\347a\370\372D\004%a\034\236N"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-19EDC34EF26A->772efb49-32f2-46fa-af6b-3b652275726d@group-B22599C3AC32, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571624423363
datanodeUuid: "772efb49-32f2-46fa-af6b-3b652275726d"
writeChunk {
  blockID {
    containerID: 1571624423363
    localID: 1571624423366
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571624423366.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\354\207\361-"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-19EDC34EF26A->772efb49-32f2-46fa-af6b-3b652275726d@group-B22599C3AC32, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571624423363
datanodeUuid: "772efb49-32f2-46fa-af6b-3b652275726d"
writeChunk {
  blockID {
    containerID: 1571624423363
    localID: 1571624423366
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571624423366.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\354\207\361-"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-19EDC34EF26A->772efb49-32f2-46fa-af6b-3b652275726d is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


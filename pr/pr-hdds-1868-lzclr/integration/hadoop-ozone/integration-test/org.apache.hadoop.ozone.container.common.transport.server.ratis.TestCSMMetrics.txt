-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.156 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.096 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571294516186
datanodeUuid: "78f57309-68a6-4752-b85f-1ae0470613a7"
writeChunk {
  blockID {
    containerID: 1571294516186
    localID: 1571294516189
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571294516189.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\232\307a\363"
    }
  }
  data: "\316u\245\344\0354a@\254\224\375\034J?\250\266\325q\260[\220\f\204\276\023#\242t*\217\342uU_D]\361\373$\333\037\a=h\036D\266K\0278$\252o\246z\200k\016\272\'W\b\nS\357\332\\u\3567\306\254\030s\336\'\255X\033\006C\350\275\304@\340\227\335\360u\370\355\367}\357\r\315be\365\226^b\036\315\366\353\372\234G\312\333\237\030^\0274P\367\244;\257\305\300j[\275\306g\030\315\264d6\355\211\\\363t\344\245.<u\364\266*\256\254g\213U\f\035\346\254c\374\315\344\370\350\307QB`\347\212D\005\266W\027M\270Y\017\365\250\361\277%\242\205\303/Y\254j\343\021\253\000\302\312s\023\262kJ\352\214\027\aQ\"W\226AEx\256\271\231]\362\347\365\347\317[@\2265\300\325\251\230*a\235,\026\307D\344J\334\332\035\340f\3005\2265\312\263\243<\305\210\345\306\345\245\301\357\212\270\321\374\300<su\335\205\f\026\267\b\304\202\2443\213\360|=D@\341\314\f\325=\201M\331\035\241\3048\212T\022\027\204u4\346\341\255\313WMq~9\343&\274\354\322\302\250\351\321\350\365\315\314\304\263\207hB\347\260J\277t=HFUw\\\030\211\271\2561\"\256x\234\344j\227a\t\000\327^\303\205\334!K&\300y\022\225\377m\310\221\3325{\346\006\2500\321\262I\277\274SV#-\2079\0163 \260x! \344f\355\216_\r\323\362*Vej\367\304s\331\266\216\247\346[\235B\370\027\036\376\253\246\020\214g&`\034\3516\021O\rr\322<j`_\005\320\\x\016\v\205\025\022\032\301v\236b\f\227\227O\265\377k\362\342E~\032\237\331\327\250\256\251W\330\002\371\365\a\300\360\025\350\355\t\277m\375\364Uq\332\333\210\253\255\037\312!\312\t\330\306/\353>\207\264`\332\vN\325E\004\351\301x\025\241\364\341\023\347\234\300[l\227)e\2435\270\'\213\223\302|\030PV,\341.\373\'\202\371\234\034\344\307\027g&\200\220Tz\253\315\253H\344>\270\257\264\335\301\206C\031D\323\252\345\034\024\004\320k\025\201\335,\272\331\203(\232\333\335\205\223\321\300 \310\203\317\355w\002.)5\276\0170\300\244s\025\262\232\373\022+\215bo\272\255D\233\000i3\r\t\333\373t(.\221\365*\037\363P\256\223a\374\204o\205?\234\224\257qd*\214W\200P\017u8\272[\303\225\273\027\\\'I\235N\025\376u\247\275\277\321\321?~wUL_\312\204y\334\002\r\000\302}\004Mo\245C\035\373\343\344\n\004\352\v\311.\003Z\340\353n\246\023\335\235\247\006\230tLx\271\026\273\335h\263\"\254\271\251\213\237;~X\206\305 \211\021\020aS\320::.\377\303\325\260\334\t\"\212$\223&\325\240I2:\226,u\v\351p\276\233\3408\356zS\216\204\304\255\317\304(\005@\222\321\f6v\346\3416\207\220\034\322]\3358\1775A\253A\232\241|\367?_-\342\377\320\023\221\221\000\332f\"\212\003Q\354\030D\037\256J\347%m\001\032\033++\037\025J\320FX\'m\301RR\277\203\222z\274L*d\223\241x-\306a\3742c\031MW1!\216\347\365P?PF\326|oR2\366\263E\354\233D}c4/\336^\200#U\023p\304\021\204\213 \327\005\331fY\250.\335\331r)P\231y>\333Fe \235\336\343\217\"\233\230\261UM\370:-?w\036a\377\352*iMM\220\323\313\242\362!\351@\375\321\271\247\357cB S\312\222wJ\362\251M7Ay\267W\313X\000\350\313\030\026Z\203\315$\001DB\207\310\003^\201+\254\016!r\215\223D\004\350\ty=Fy\311\300&\263J"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-23CC66540DE9->78f57309-68a6-4752-b85f-1ae0470613a7@group-214815316607, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571294516186
datanodeUuid: "78f57309-68a6-4752-b85f-1ae0470613a7"
writeChunk {
  blockID {
    containerID: 1571294516186
    localID: 1571294516189
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571294516189.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\232\307a\363"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-23CC66540DE9->78f57309-68a6-4752-b85f-1ae0470613a7@group-214815316607, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571294516186
datanodeUuid: "78f57309-68a6-4752-b85f-1ae0470613a7"
writeChunk {
  blockID {
    containerID: 1571294516186
    localID: 1571294516189
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571294516189.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\232\307a\363"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-23CC66540DE9->78f57309-68a6-4752-b85f-1ae0470613a7 is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


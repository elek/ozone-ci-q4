-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.786 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.726 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571173922262
datanodeUuid: "d9a6ade9-356d-4d51-a739-bd6dfa7670ad"
writeChunk {
  blockID {
    containerID: 1571173922262
    localID: 1571173922265
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571173922265.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\271\267\372\r"
    }
  }
  data: "\347D\022\266A\254\335.\005:\262\346\317#\016j\337\212#K\305\213\230\333\306\271\344R\177\371\342\234P\032\225\372\201\251\340\241\373\002>\233\036\027\343t\302\222T\317\000\376d\353\333d\027\223Cf\331GD\n\317\354\v\260\354$\303\377\2527\271!\342U\177\350\212s*T\035\235jh=\255\246\n\266\210\a\337\033\273j \347\'X\312a\273\357K\221\356\364\222\355n`\030\232!\230=9.\333\257\032#\261\313\026\236nuS\353\254Ce3\366\v\326\207\023;0\277D\317\242O\300\237ph7\a\367\000\2542GU\251\310:\316\"\376\360\fd\236\027\201a\332\265+{Dy\000\362\036\327\207\265\n\250H:\274/\271\364f\317\312\025x\212\004\267\356#\203y\271\352\357.\347\321\020o\202\310ds\355r&\355\274\271\256\350t>\027P&\017\237\317\017\231V\207\276o\336\2126\313\240.\373\334\0213\234=c-\3546\215f\243a\\\225N\211\201nD\325\363\316\v\361\247@>\266-[&!\274\333\315\246|\266js5\020\364B\270\027\262\325\v\277\227\257`\"\356\301\261\005#\302\350\322\337[8\365\243\337\224\027\031\222\255\315\215\244\316\377\adQ\314\005{vo\033\230\221\023\277\334=\250\344K\2030\333\350:3>\255\022I\241\376}\352G\234\352\a4\026\2710A\000\325\246NZ\326\243E\a\216\335\213\025\276\304}u\026r]\245ki\304\262 \302\271\t\376\370\342e4\201,6\203\275\251\346\352rz\365y\323\036I\f\374\363\b~\177\025\365\244\266\370\366\300\355\210\310\262g\236\376b\245`\246R\n\370\bJA\242}\276\336\255A\210\'\323\331[\200\205\331\250G>xt\241\261\275G=E\247\204\344R\340\036B\251\325\341\323\017Z\336\314\037]\303\037 \335\357\326_sH~\'q\331\035py\270\340\326\210\200\335+]\002\332\016\tF\317\002t#x<\312\025z\272?\371\316q\3431\017\272\032\262\005^i\244m\377%2\267T\316\273\005\223\240\006\322\032K\203\250\371X{g\277\367\266\221\016\223\215\376p\360\236#\255\236\227o\224\242\3206\361\360o[p\213\212\354e\216\370\241\030\273\310V\216\330\201\227\367\265#\201\230}6\320\356\255\370\237\022\363\342\241\237\364\177a\363\351\210\331\213\314p\305\201%.Ey\3628\340uz\363\347f\266\377q[g\231\031\201\b|;\240\372\"\361i\356\240x\033*\200\234\355m=\353\020P\340\207f8\374P\t\2741\233\273\234\265=#\234\356\316\222\322\266\277\n\304\344\326\034H\242\"c\300R\311R[\206\324m\233\270\343\254\370IC\352\225\256\331\321s\353\033\336%@S\220<\304X\372\224&\20604\254\v\371\026/\022\342\227\266\272h\253f\177J\216\f\3035\230\035\023\023Db6\257\325\317\337X\b\031\365\0239\226, \223>#\266\367\274\261\364\b_\"\306>\242>\302\265I\266\253\257\217\266=\202)\a\313\a\030\230\374\361\363\224|\256\326e)b\321V*\213\021\234\255I\362\250\301\30632>\n3\251HB\035\243\005g#67\234\231\023?q\265\263\206G\035\036\b\237\3560\021\353D?\213\265\030\270\037c\376\375z8o\310\300\377L86\017\021>\373b\316S\350\'HF\377lo\f\034}d\004f\261\205:\226W\374\0322\227\215\326ux53\346\351\216\363\230\234\0274|\211<\213\262\256\177\323\236j\247Rc\350\262\223\020\372i\362\227y\265\200\366\323\300XyX\355\034\232\250\351\364\357\311Q]uO\254!)\274\271\254\314\232E\025F\271\002G\016\222X\000nB\347pshGBy;\201MG\035\212\350a\200\002s\220\t\322\314%\261\362`\365\205%\r\341\"\244"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-539AB3A36CE3->d9a6ade9-356d-4d51-a739-bd6dfa7670ad@group-648EAC23C880, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571173922262
datanodeUuid: "d9a6ade9-356d-4d51-a739-bd6dfa7670ad"
writeChunk {
  blockID {
    containerID: 1571173922262
    localID: 1571173922265
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571173922265.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\271\267\372\r"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-539AB3A36CE3->d9a6ade9-356d-4d51-a739-bd6dfa7670ad@group-648EAC23C880, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571173922262
datanodeUuid: "d9a6ade9-356d-4d51-a739-bd6dfa7670ad"
writeChunk {
  blockID {
    containerID: 1571173922262
    localID: 1571173922265
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571173922265.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\271\267\372\r"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-539AB3A36CE3->d9a6ade9-356d-4d51-a739-bd6dfa7670ad is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


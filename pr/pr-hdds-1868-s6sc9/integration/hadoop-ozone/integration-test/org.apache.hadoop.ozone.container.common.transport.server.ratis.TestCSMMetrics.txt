-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.508 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.445 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571339173755
datanodeUuid: "141bb45f-7066-4219-99a2-786bf970e65d"
writeChunk {
  blockID {
    containerID: 1571339173755
    localID: 1571339173757
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571339173757.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\027\250\033\222"
    }
  }
  data: "\375\341\030\315\3564\2572\316\237H\375\310s\317\204\267X\"\32191\001\275J\351ke\256\034S\361+1\327\361uU\214\216h\214\t\250M(\252r2\340u\036c\200\366.\\a7;_\b\"\232\b\230Y\216c,\"Sb\3432\1777\034\220\034c\2615K\363$RO\357\021Z:\341K\216\351\307\021v\306u\220\224z)\2614\021\206\261C\232\030#\017-4R.K\231\235\354\355\025\365\303\334p0\235~\250\b\314\307\037\'K\225 >\226\3643<\\:\371+\316\211%\247<\236\003\340\236\346_\243~\353\301\020Z\276\027\306:\263K$\265l(\"\372\277\026\3231\036\022$\0216T\327\340\375\303\rH6\306m\361\303\333Xw\3053{\321\231\202\327\016y\344\201o\255\022\1776\254\326D\333B -x0\203\222\344\343\246\276?JjG\3447^JX\371\301\270c\027\213\212|$\374qn\301\316O\200\267\a\024\\\211\253\205x\177bC\221X\355\262\336\023\216z\212\217\031C\220v[X\200\316w\033\256u$.7\251\214UO\024\3657j\005\367A$\t/\231\023\374\nb[l/\002M\202\235\243\027#\362W\310@\343)\361r\336\344\024IS\037,\321\016\022\204a\340\277\323\324\324z2\333\021\320\203FL\350\337\302\274\\\335c>y\025\003p\270\362F\231zv\331\323\206d{MO\332&}\023\211\273Q\312\326\b\031\201\237\263\027\234?\340\320^1T\300|L\023M5[/\300\236\342i\334q\\\360\344A\213\241m\r\372\022\324\004\020P\2076\207}xc\343\245lp\002J\367\272h\240\374\326\n\343-\300\201\344\"\326\313\240\300\243pU\300taX:\267\235\211\203\246T\215\340X\027\334\003\275\026c\027\310\233\003\023X:l\212Z\251\2378\356<\205\204\352S\352\231\201p\310\017Q\232v\347\"\264\001\320\342\026r\022\323\352\304\307D\177n\301\365\032\302W\026\376 \350)9j7\360\231\311\365\322\034hK\244\305[c4T^p\220\304b\301\212C\212\267\306(\r_X\314\r\265\327\237\037K\371\266\200\301\277\264\223?\321s\"`\346\332\202\260\327\256\201/\327\2066!9\270\027\005n\207\333]\n\b\375+,\256US\361n\017\327b\352h\236\000\260\233J_2\027\004\036\033\256J\337[&t\371\255G\312XLr>)\353\242\372\035\317\306\252A\273\205\033\257n\257\023\001\027\261\312\255\305\315*\277\330\336\240q\217\001\026\205\'%PD\377)\214]a`\266[\375\v\r\327B\334p\322i_\357/\376h\364\263&\204\344\202 \235F\277\353/\f\\\3329\264[X\270\343\261\003\345Im\334\367\207\"\302\222\322\322\337o#\335HV\254m\235)\210\230\271\016\2633c.>\263\367<\a\006\t\256\212\346L\352\211k\356\177E%\241\2476\354\220\203r \245N\3242e5\366\316\334\032\201\\2\376\343\n\212y+\212\375\305..8\033\375\355\022%\320a*\004;\277^\312\234]\235\2171\311\353\031Rt\t\326\020>=e\267F^,\373$\237`\273)\n\310\223\262\v\234\361~l\270\264-\256\214\352\303|\272S>\336\024,D\025\222\222\272\003\375\340\362\225\231\207\306$]mL\034\222Nu\3526\223\r\v\003S\236\255\003\316\\\207r\006XKU\002\204\370\216J\021\262/\271\333\027\215c\245\273;\211\336\364\0224\222\302zS\322\216\353\376\276\257\213u\336\203\021\020\222\20045\021\253\304\377}\232\037\333\223B?\\Cp\251al\230\023\a\362\026R\245|^\003\223\315\f\332sB\202\247O\252\264\000\355\000w\327\366\264\355X\026\303j\365\021\355\334\330\215\340)\275\217zt\336\271\250\213\362&\201\311\203"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-50936E39CC68->141bb45f-7066-4219-99a2-786bf970e65d@group-5E37E25667B7, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571339173755
datanodeUuid: "141bb45f-7066-4219-99a2-786bf970e65d"
writeChunk {
  blockID {
    containerID: 1571339173755
    localID: 1571339173757
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571339173757.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\027\250\033\222"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-50936E39CC68->141bb45f-7066-4219-99a2-786bf970e65d@group-5E37E25667B7, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571339173755
datanodeUuid: "141bb45f-7066-4219-99a2-786bf970e65d"
writeChunk {
  blockID {
    containerID: 1571339173755
    localID: 1571339173757
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571339173757.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\027\250\033\222"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-50936E39CC68->141bb45f-7066-4219-99a2-786bf970e65d is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


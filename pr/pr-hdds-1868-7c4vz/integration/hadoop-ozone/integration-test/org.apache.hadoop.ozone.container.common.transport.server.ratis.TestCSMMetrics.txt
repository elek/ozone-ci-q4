-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.89 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.805 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1570657654902
datanodeUuid: "e46a37a1-c922-491b-9c5a-d4a776be2de1"
writeChunk {
  blockID {
    containerID: 1570657654902
    localID: 1570657654905
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1570657654905.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000(>\231D"
    }
  }
  data: "\317\205\2030\371\0362]\273<\177\034\306\372\267\262@%\316\016%Y\365\363\036:\225\305\202w\253\226\321\017\021\023MB\205\a=\016\221\005i\3569S\354\333.y\032\215\270\324t\361\205\275C\302*\254\266\302\354\337%\v\354r\020U\217\270\017T\325a\310\304 1\226\005\222\022&\371\254\aK\306\342\000$\346P\'\016\374\313\316\240\v\352\023r0R\301f\265u\376\306\355\246q\230\244\356\372\305\006\216\0339\222\001\312\370\220p)\3503<\034N\272\t\222\fgq\346}\034\0364\001\264J\210!\325\312\357\006\312\302\317\267\207#J\374\265\305\177\345\026\261\3107\271vK\260d\244\216\356\232\205\355\222U\205\003\017f\207\273\203\270\325\335\177\216\322\342{&\017H\023\304*\273\372u\372\375\275\026D\220\216\223\355@\315\316\242\355x~\332\341-Mi\a\333`\357)\003\273\367u\031M._#\025\223\237R\246kT,\207\207\243\027\260wfS\343\332\023\320\301\343[\037\237\031no4b~\247\352\025\037\\\345C2\r\207\334\313\303\'LyR\302\rU\255\305\247\364\261\301\236W\202TC\252$\331Tl\357,\335c\305e\3634E\334\316E J\236\332\306u6\257\267\026\006f|\324\221\274K\346\345#\2222\333\b\234T\351\222I\211h@\306\207.4\364\204\345\310eWe\177\253\212\\\362\036\002j\211\221\351~\fO\351\374y\337\347\351~\343C\177h\026|\027\030\240\364@\000\002=\322\340w}\230:{\367\376\353\217\270\342\260\373v`7\'a,\370\212\366V\221\203\331\177\246\227q\312\315\177\320\322\002\2428\312\216\200\300\".\364\323\213\274\331\212&_\270\356\354\230\336\375$\335#\317g\2657\261\372\031\236T\346\035;\243\310\252\t\243u5R3D\021\207\032Do\262\310\270m\205\rvP\362y\204\366\312b\334{L\261\360\363\327\a\356\273\200\342\203_\346W\253\276\266B\214\217?ve\201\331\337\377\037\306\236\345\3724\304\373\v\344\255\356\203d\324\331\fE)I\321\325\030@h\367\364\005\250f\371\220\034\363,J3\350\350s\273\030a&,\224\347\242\232\031BR>\256n9T\370\267c~\351\224\023\251\372\356#hP\332\353h?6/^\271\333\026~[#\325\355\023\201\356\270\257`gK\006\337\342\350Fh\367\274\311Kc\356\210C1s\022\340S\201\n\310\254*\212\0305\266.\304\033j5Y\177\037\205\262\324\232\244\003\372\251\t\351\363\347\360q\335\213\244al\032\317\313\374\306\254;\273^A \215\323*\202\362\a\245\305\37368\251\237\t8\213\250\357\261$V[P\022\037E\002\205\346\364\312\202\344\357\356:\365`\204\r\217\023s\221\262j\344 \017!9%\257\270\257&/\317/3\247,\303\347\256\224K\024T\327o\231\220\366y2\351]\202\361DqHC\002\336D\271s\302\326\256\037\016\364\004\312\317\000N\216T\206\304e\300\357(\036\353\263\243\'\374q\'$\262\231rtV\273\306\n\326ye\353`\220t\"\346^\261\317\300\3355bp\2554\204{HO\n\213\354E\305jJ\320lOA@>\003\302\265y\242\177D\t\203.\347\316g\272\266+\033\347)\307\273\260\223\371\302\020X\030\231\220\236us\"E9\v\346\356\271p3\320\325\230\267_q\272jD=\026\f\034\351??b\350\a}\322\214\216\177\320\253M\204H\207c!R\016R\226\347\353@s\206[\332Z\301\260\240.;\322Pu=\260rk\0045f\274zO\254\216\364\303&\3346\224\315\246~\3644\251\032\031y\327\3270\250\266f\b\201\276 \001\030\351zV.\370M\307\021$e\233\220.\277\202\340<\326LVX\306\353\r\325aa|\024\235b\336"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-02F965ABE17C->e46a37a1-c922-491b-9c5a-d4a776be2de1@group-C18F8B35E896, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1570657654902
datanodeUuid: "e46a37a1-c922-491b-9c5a-d4a776be2de1"
writeChunk {
  blockID {
    containerID: 1570657654902
    localID: 1570657654905
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1570657654905.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000(>\231D"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-02F965ABE17C->e46a37a1-c922-491b-9c5a-d4a776be2de1@group-C18F8B35E896, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1570657654902
datanodeUuid: "e46a37a1-c922-491b-9c5a-d4a776be2de1"
writeChunk {
  blockID {
    containerID: 1570657654902
    localID: 1570657654905
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1570657654905.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000(>\231D"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-02F965ABE17C->e46a37a1-c922-491b-9c5a-d4a776be2de1 is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


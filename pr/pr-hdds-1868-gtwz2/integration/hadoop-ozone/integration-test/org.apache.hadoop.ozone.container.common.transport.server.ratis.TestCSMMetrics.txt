-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 184.092 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 184.017 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1570572098185
datanodeUuid: "654c7731-8a18-4a1c-8fb2-7aec7500401e"
writeChunk {
  blockID {
    containerID: 1570572098185
    localID: 1570572098187
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1570572098187.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\023\24064"
    }
  }
  data: "\235\n\322\363\033\337\265\v\226*V-\213\305/\237\340N:o^\210\325\210\374\267\253@!\310I\217\231\212\352\032\312\317?\237\342\326\177|\272a\322\237\314\244{\222z\362\373[!\356\016~Y\036n\236e\320\003\001U\017%\367\277\243h\032\357J\323\345\217\331\355\320\333\213\177C`\334C\366\267\361\177\221Ftg\225!\201y\365\373\275\316\032\343\270\250R*`M\307\032uV\033\317\251o+x\207\344\270\226u\225\246\027\344\206\305\230aG\366u\024\363\n\361\357\243\030\220^0\257\376\313\223\351;\304:\261C\211\372\344$?\363+N\f\0266(x|\206\v;\205A\336<Guk\341\225\271\2044\002\332O\270\261O\271]\230\347\006\200\307\017\240\300wc\363\364\273he\r\342\331\f\\x\252<\245\352\031NNk\343K\\\036\202`\225:\227)-a\257\372(!-\317\252\273\031\312\373\r\230/LN\'\353\027\323\214\324D\253\377.\336\000\2310\220\"\202\302\340\227\355\204\261\277}\000\031\262\365\214\200\230\031c\361\017qP\2739\265\367\027A\302\307\017]\372\304\032g\3556t\317\346\000\277\317\252i\003\233\036\b\2456\230A\272h-un\205v%v\372\343\313\020l\004V\000\201\374\216\226A\276=\330\023\315\277\031\312\346,_\326k\027\216\037\227$\022h\224w\316\336?\2342\n\376c\240\324dd\255\345\263\202\321\242\034\032\307W\017\200\206\f\213\302\'\035\322\274\027\243\365\202\333\311(\253\277w\206\237\324\304s\340\267\327@\030\373\237\313\006}\202\t\240\360N\357`\237_Q\312\363 \344\207\024\342\364\221\313Z\347x@\202{\267\354\'s4/\222\204\206,\364\231\200\215\325O\364\340\215f\214&\272]CT\"\234\201\325w\337\214\202iRHE\206\224\335AzE\vV2r\311\311;TC\337\207y\240\035~$E\226R\017\261\264\277\355\265t\352o3\356\315|E\337U0\323\372w\353\247T\373\027\372\373\313\231\242ec\372C\271}K\242rdO\273\206\231\335F\370FV\342Z\277\257\252cRq\203\261v\373\210Hg\'\342@\017\324j\266\310\227\312\310\332\367y\037P\006\210\357U(\260\032\347\223\325FH\366}\024\032$4\3033z\033\f\025\310[:2\317\036\231~\016\236q\2323\021\3640\334k\363~\005\034n\000\272a\333\246M\367\366:t\214\032\216E\310\325}\235\275\361\207\244\234\340\302$%\226f\315\221\027\003z\230\264\307\322\365\343\343\b\037\342\022I\337(\t(\306\214\027\\\017\"\020\303\310\275x\005\037\217\265\t\211\206\021z@,\231\257\372Sc9\036\317m}[0t\324\240\365\001u|AEF\232\375a^\352!wZ\267\347\371m\247\035\252\232\026E\327\236co2 w\016\250\032Li\245\225\355t4\273\363\214\363\341l\217\350\205\325\a\a\327\252\355_\352\212f\376\2631\340\215v\252\246\373\231\226~\037\331\341\257\341\207%p\332/\325\266A\201\221\b \220\276\260q\355_\271~6\350\334\201\363%\372S\030v\021\355\254\336\354\262\003\035\373\343E\330\370\264\024\263k\003.\005\256\3025\2779\350X\301Kf\374w\243\255\274E\221\324\307\311\261\035z]\333\372\331`LD\215\033R\036A\314\235\306\272\242\332z}-\237@U=\364Q\351\0255\024\002Um\362C\200\303\330\231\017D\037\244\016\225\242\337\230\337\023\352\345qp\261\\jh\223\344\\\177\032\306B\r\025\0222\343\\B\207\177nj\337\213\240\203\203Z.p\271=\322l\210\2567<\017\266k\016MZ\n\332-\320\327\206\256\251\257\'\211\221,\330M\375V\243P\333\354\355u\240[\310`\214\256Z\261L\225\336\325\266\200\246\326\247\335r\223\221\177"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-252602DA0E48->654c7731-8a18-4a1c-8fb2-7aec7500401e@group-1D4FEE90F6C7, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1570572098185
datanodeUuid: "654c7731-8a18-4a1c-8fb2-7aec7500401e"
writeChunk {
  blockID {
    containerID: 1570572098185
    localID: 1570572098187
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1570572098187.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\023\24064"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-252602DA0E48->654c7731-8a18-4a1c-8fb2-7aec7500401e@group-1D4FEE90F6C7, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1570572098185
datanodeUuid: "654c7731-8a18-4a1c-8fb2-7aec7500401e"
writeChunk {
  blockID {
    containerID: 1570572098185
    localID: 1570572098187
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1570572098187.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\023\24064"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-252602DA0E48->654c7731-8a18-4a1c-8fb2-7aec7500401e is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.408 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.346 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571261127441
datanodeUuid: "39d5e63d-e4ea-4032-aba3-fae077b3f78b"
writeChunk {
  blockID {
    containerID: 1571261127441
    localID: 1571261127443
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571261127443.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "r\034\276\356"
    }
  }
  data: "~\224iFx\313j:C\203\312\211\020\362{\203\a\016f\222x1\364\005\211i\266\243\f9\252Y=\332@\221v\vX\334]\264\2242\001O\023=\204\344N,e\243\305lvO/\301\344\234=z\275\216\306\263\353\n\261\233?\271\"\304\240@\nM\377Qo<\374?\354n\246\364\255\266^|\363\277\2066\336O\304w\033\2303D\257K\aV,f\353V\355\032\312\263h\251]\002I\353\006+\234:\225\342K\226R\005\371\227\030+\213qR<\031LoS\347\000\002#\350\372\262j33\253v\361\323\333\312\305\362\3074\265\212\337\305^\254#\373\000\177\345\311\364\v\371\371U\376\022/%7\337+\212w\273\270\256\375\274\255\323\036\r\235\310\236\037A\373\206]\361\fG\252M\247\n\273v\246\f{\252\t\037\220A\303Q\256&AM=h\263on\300Kq\030\030\275\2612\314\201\357B\3656;\030\212\375\347%\321C\243|\335\250\251\233\\\375\336?\233%J\r\326\330\261U=\2408\016\241\213/\226N\033\325;\204e\335\353\237\320\275i\313J\261B\340\277]g\017\016\367\370\222\026\\\332\271\\K\231,\320\240\a\323\023\032\"d=\264~\020\036\317,\027\315\323\004\307\006\233\244\211\327\3317\037~U\a\336T\023\260\vM\377.q\242\034\301\320\216\0346\335\247\310\370\300\0024\n\331\035\375\a\367;\v\213\206\267\242\325\234\243l\177\027\335\242\263\210:\240\237\221\306_\b\365\022\243z\364\232\242\003\2445\371\025\250\215\277\0060\256ji\371~\'\343jH\t%\022Hk0\321`\242j[\215 7\f1\217X\'@\025F\224p\375\245\343(\307w\216\232\005\220\207\253,\035L+{\365y 0\201/\240\227K`#1\220x\a\322\31558\004\251m\206\"(B\005c\264\307c\326Y\031\270\201\025\016\323\330\251J\315wO\366 \277\343\332\210tH\264\256#9\246BS\211\303\024Nx`\tx\373\336\017\253q\256[\f\344\353\v\267\312\321M\v3^\330\324\226(O\267i_\374@Xd#`\217\226\v\274fh\234Q#\'h\031\314EBU\342%\325\\\023[,\211\321\255\004m\243H\311^\001\275|\r\217\276I\371\326_\301I\0227\265\303\335B\335\000\n\tOot\326\203\000(\360\2775\323\224\302y\270\304\314)9\002\237\017/\2631qBx\362\030\327c\323\'\270\bn%X=\361\365^\221\332\256\360\3207\037|\311\322\213\226\235\305\240Cs&\257\\?Z\2609>\343\204\311\342\206\255M\035\036\235\t\000k\320E*\020~\037\b)\227\246y\336\344~^\241\020E\315\302\344\267\303^#\037\261\202\314\034\312\224\215+\215\026-\206\033HSChn\302\246\317(\236_\313.\314~\344z\273\2519V\350\002\247\200A<Y\370\202\354\217\361\031\212\001\245\206@YwG\275?)\017!\353N\262\222\316\261\026\333\302e\373w\316H\326T\265\253\276\372\213#\345?\366\317\365\312%\265<\306/\r\367\326\270\034^\213\302\'\253S\260:h\'\f\362\021\253\300\232\343\227bj\\\244?%.8]U\017D\311\031q8\230;\2067\300\371\326\261m]\343\305\tG/\302\267\200\234\237\270\202ad\241\346\230\000\377\230\264\316g\242_\377\a\311\242\241\304x\224\a\021F\325<\031\304\375\300\2275\\\334m70\001~\207;{{\254Y~\364\257k\215UDOA\236\237A\aq\n\233B\002Y\016W\310\024\275\224\325\367\2763Hv\274\366?\300\274l\227\251\221\332\305\033J(<GK\025Ne\022/+\253h\327\226\234O-\202Qh\241\254>\021\032\234a\345Jg@\323(g!?Z\344\031\260\341\365\232\312?;\217\232dA\214O"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-092CAE78B0D2->39d5e63d-e4ea-4032-aba3-fae077b3f78b@group-810BA8571F9F, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571261127441
datanodeUuid: "39d5e63d-e4ea-4032-aba3-fae077b3f78b"
writeChunk {
  blockID {
    containerID: 1571261127441
    localID: 1571261127443
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571261127443.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "r\034\276\356"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-092CAE78B0D2->39d5e63d-e4ea-4032-aba3-fae077b3f78b@group-810BA8571F9F, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571261127441
datanodeUuid: "39d5e63d-e4ea-4032-aba3-fae077b3f78b"
writeChunk {
  blockID {
    containerID: 1571261127441
    localID: 1571261127443
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571261127443.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "r\034\276\356"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-092CAE78B0D2->39d5e63d-e4ea-4032-aba3-fae077b3f78b is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


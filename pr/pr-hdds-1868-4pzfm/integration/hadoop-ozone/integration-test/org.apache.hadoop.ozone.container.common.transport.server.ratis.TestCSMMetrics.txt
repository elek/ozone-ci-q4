-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 184.092 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 184.029 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571826161667
datanodeUuid: "e09d6c48-831b-4b4b-b153-c7df20f8937f"
writeChunk {
  blockID {
    containerID: 1571826161667
    localID: 1571826161669
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571826161669.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\250 \2576"
    }
  }
  data: "=9\277]\215\374\033\022\266\217\236\305pXKT\357q\031\036\331\203\371\306\344^ir\314\330^\001\213\317\251\230\316\031<\313\224\320v\260\356x\031\"\316\000xh\205\2662\307\366x.\301}^/j.0\263n,\274\244\022{\310V\300\370/U\304\367`%\227a\367\316\024\230\247\211\366.\177\210\302\267\372\234q\304\320\277\241\311\212pz\363\346O*\334&\331\375\307\203L\265\330B\337}\020\320\362\326\233\344+A\307n\"\325^\r\225\307{\0214\267\022\367\316\302`\320\024\020\212\251\337\240\307\337\031\235\260\021\027\374\374\205\370a!u\324\317\335\277\000P\324\346\202\346\255\237dn\305\325\217?\354p\336*\264\374Y\301<\335\307Ryr+h\235\001u\025\200li\265\202h\260^c\001 \324\213\204\205\326\306\357\252U\365`$\001\324\255\317\300\362\027\025J\027\340\204\361\205\f\2770\205ZB\210\2464\316\230\353\f\030\367\250\301/\033#D\355\202Ex\263\377\301\213\372\033\263\336\364l\016\310\363e\257^\370X\212\346\f\347lb\376\004\\S\347\324\266\236\'kGL\ti\334\371\210>#\276\3509\022\036\006\002\360\247B9h\227;\017\367\226m\314\227\260\034(\230\301\003\023\"\347\236E\261\"\020\222\251\026\302\037\315\315\\\004\\4\247\rr\024\371\255\357\356!JD\0170\363~\224~+\347A\336^F\217TI\266n4\'\031kF\321\315\327\201\371\370\370f\323\004-\257\201;\233d\240\267\322Q\"-\\q\316\241\023\024t\004\372a\353\017\300\177\254\241\336\315\f0\307\315\237y\326\244\037Z\v\345C\226\231h\363k f9\230\252\253\347\277[\210Q\f\003=FG\257`\332\253I\031\364\311\305\334\024/6\244\207U\314\227\315\341\037%\335k\325\033n\021\317Z\271k\334\016$\031W\027|D\264\247L\231M\\\311\203\2522\372\001\365\241\316%\360r\237\2723\035\244\342\373\252a_Fe\231\317\245?I\347R\214X|\302n\340\256+\377\324\000\024`?\305\374\3263\226\221\376\204\354\032\352\216\260\332\276+\"\vsr\2558\2777\262\352iv\227j\225\272%\363\254\204\226\250\250\\\204\272\021K\363h\233\375\307W\'\316\346\206\033\225j\214O\337\207\v\342\331\201\317\234\314\223\023\362\261\277c\037C\346\260:gF\321\v:\333D\a\300H\375\320\352\36188 \264\374\177\304d=\271\307\210t\350\220\235\341\316$\2051+\211\244\200\232\370Qj\323\t\371\253\216\aK*\264\204\202\211\327\317\236\200\261\371o\215\260R\\\216\307v=\247\fx\240?\b!I\361\356V\n\257SV\215D\242v\026\270\'\342wN\246\336\027d\246\345\a\375\203c\341v\206g\216\325B\004g\273\'m\305$i6\327\235\260\370\024{\314\347\367o\343GE\246+\337\3275\317(\372\341\262\024\r\\\276\031\221Z\024\277\034\016\212\214i\352\016\233\261ZT\v\240?\322\355\326\274W\016\301\350\247\266[LN\306\3740D`\366\224t\035\336\310f&\3552\307\235\244\006\223OI\245\362=\234\241\301`\343\230R\3743>\224\016\310\024\342\254\235|N\261\310\267\245\373@\222K\240-p\262+IVT\031\353\021\b\304\b$\344N\311\274\342\276\025\232\035\345Ss\307\302J\033\340\214\224d\037w\b\237?*\357\2156\352r\340\307\f\205OJ\306{\350>t\021\245|r\371T\220\024$\276\332\214 /0m\035\374\357\033\v\256\201#]\271\307\354Dvr;}\374\033\331i\325\336q\226+\t\017X\261\236\f\327F/S\220t\'+\002\367\350\304\255\275\215\f\202#\235\256\033\016\315t7\235\0368~\264\035\0165\006\201\302e\311\325\355\376KEy3\331k\356\001\031\n\003"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-34ED9F15CC12->e09d6c48-831b-4b4b-b153-c7df20f8937f@group-680113FF8ABF, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571826161667
datanodeUuid: "e09d6c48-831b-4b4b-b153-c7df20f8937f"
writeChunk {
  blockID {
    containerID: 1571826161667
    localID: 1571826161669
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571826161669.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\250 \2576"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-34ED9F15CC12->e09d6c48-831b-4b4b-b153-c7df20f8937f@group-680113FF8ABF, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571826161667
datanodeUuid: "e09d6c48-831b-4b4b-b153-c7df20f8937f"
writeChunk {
  blockID {
    containerID: 1571826161667
    localID: 1571826161669
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571826161669.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\250 \2576"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-34ED9F15CC12->e09d6c48-831b-4b4b-b153-c7df20f8937f is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


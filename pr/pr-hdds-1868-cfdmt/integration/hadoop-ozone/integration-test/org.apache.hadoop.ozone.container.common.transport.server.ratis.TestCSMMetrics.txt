-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.594 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.524 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571077930477
datanodeUuid: "762155e4-686b-46f1-9a63-2b14bbd6d880"
writeChunk {
  blockID {
    containerID: 1571077930477
    localID: 1571077930479
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571077930479.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\226-\242\f"
    }
  }
  data: "i\347z-.\222E\f\214\024=w\330\332\270\f\204\245\373H\002\362\rt\332\300\020\243q\203\"\256\033\373G\b=nw@$\267L\357VP>\334\373\216.-\306\375&\356)\352\244\220|\n\372\213\250\364\342\024\235\036\351S\351\201\311R\263\3408\242\177\0317\t0\246c\245j\a\270d\033\"e0\036\340\033s\354\302\243w\271\b\r\253\326\253>\206\003\216\005 \026\003\222\322.y\375\217\376\3755\202s\357v6\332t\237 \364QO\205\331+/\272\234U\300<\2443\234\'\3116\035\334K\033\207\374\375\322-\326\256\366\330\203\001#\251 \214\307\350\247\005Z\262X\331t\272\226\317b>\372\032{\'\307\372\241\323\275\301\261\376\304\307\\cX\3574.H\034\366t\177\v\210a\334\236\357\237\353\366\254c\t\nS]\332\000\005O\2654h%\001\273\253\345\212cv7\207_i\'\251\324S\361\221b\251\365w\257\304\220\365n\343\201Y\272\262\324\357\332\347\033\324\200)FMRV\030\366\325N]\371R|%\256\324U\0340\240\302\327\256\315:7)\353\373t\324\275\0003I3$6#F\275xz\256\277d\031C\016\331\360?\331\247Pf,\253\311\277\363\364n\211\300As\246\346\033\375\225}\207\246\323\345\356\035-W\371-\212\255\a\261\203\215\205\f\337FJ\361\365\300\371\254\"\346\377\253nd\311\f\021T8\242\247C&\v\321\363e\220\244\372\351z\003\033\004\2377>\377\024t\346\215\333GA\301K.M6^\'i\315e\373\2742APs-\262\234V^s*9\226\361:\275S \325\362\247\215\341\253\311\"\vH!\017\001\365\356\r\2166\026bK\203\215\b\315\347p\'i8\272\274\225\213}\203Xm\326\314\022D\216!p1=\311m\257\212\033h\200\264\306\300\265\253\204\310T\304lD\206j.\263\v\322\276\341,\246\025\353\317\315(|q\201H|\005\356\327\312\324\030\202r\304\016\315g\ncK\206\250\322\212\177V\304\370\247d@\rRED.\307\364\023\342U]=\177X\305\311F\304@>\001[\ai\356\331A\354m\356xTB\aEX+\273}.2\360\376\241\347\275G\247\'\347\267\263\205.X\317`?\325\244\357\234\231\003\224\271\b\235z~\017\265\330\314@Y\"\270d\367\261\237\330\360\311\357\3216;\345$\322\037\245\265^N\t\343t\245l\033\v1@R\335\246\265$m~~j\270\343\003\035>\362c\313\317\320\215\314H_\233-\bw\223\247\342qFk\247\024\364\225E~\\(>\324\304\215\332\3566\322M\331\356\354hZ\232\245\365\2626\261n/\373\274\"\265\t3\313I\324d0\202\374.>T<*\262\262\366\202\355\2201\330\001\nK_\217+\"\362\334aZ\231o,\305\276\2418n\234\204g<\264\000X\346\366\372G\023\237\227\307\375\004bk\242?\026c\245\217\365\214\322\345\304\300M\2550]\\\331\213\331\224\233\337\331\363\254+{*\364\336L\004\005\023}w\\e\345\343n\2548\303\356\304\a\251\263\357\237\352\354f7\r*\325p\345\037oB\366\374\320\f\265l\305{\242\270\200\035l\356\000B\223\306\031ge\036\346\317\234`\255$\365\216\243\355\312\375\001\307\027J\321q\377\337\335\233\330T\215\366mG_\220\226\371\333_ay\310\374U\236x\215\367Inf\250\341(\217\255\304K\035\f\320 V\361\365\343\210\244\f>\207#H\331}\262\023\317\027\227p YH\032\262^\242\035\0026\001\316g$\273\204\323\247\311(\315Q)(\322\336\360\377\004\341\350\275\374E*\273&\325\233\235j\212$\a9\003\311\221/\026\3210\v\r\302\350\024X\245q\330g\313;\246\026V\242\b\274\225\'\023\000\325\330\340J"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-F30CF0B6EF93->762155e4-686b-46f1-9a63-2b14bbd6d880@group-B28D1796BABC, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571077930477
datanodeUuid: "762155e4-686b-46f1-9a63-2b14bbd6d880"
writeChunk {
  blockID {
    containerID: 1571077930477
    localID: 1571077930479
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571077930479.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\226-\242\f"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-F30CF0B6EF93->762155e4-686b-46f1-9a63-2b14bbd6d880@group-B28D1796BABC, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571077930477
datanodeUuid: "762155e4-686b-46f1-9a63-2b14bbd6d880"
writeChunk {
  blockID {
    containerID: 1571077930477
    localID: 1571077930479
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571077930479.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\226-\242\f"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-F30CF0B6EF93->762155e4-686b-46f1-9a63-2b14bbd6d880 is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


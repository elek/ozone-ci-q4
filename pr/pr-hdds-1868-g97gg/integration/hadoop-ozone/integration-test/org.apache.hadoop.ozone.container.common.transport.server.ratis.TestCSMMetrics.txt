-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.103 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.048 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571276147648
datanodeUuid: "eb5b6878-d6af-4765-9211-7c19367b6298"
writeChunk {
  blockID {
    containerID: 1571276147648
    localID: 1571276147651
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571276147651.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "b\030\032\302"
    }
  }
  data: "\246/\001\306\306vX\277\260P\212\210\276(\026-V}vk\016=`k\340\314\335m\030\264Y\222\341\251\341T7\264\005\036]\330h\275\243BfGm\360\227\361\a\343:d\345\261\201\336Q\3517\005\374\t\232\311\215H\225\245\017\322W\031\313\332A\310\362\306\233oU\321&\003l\n\221\211\311\001\1774\324<-$\326k\324\367\350\362v\237\243lA\366R\214\"\355/\360\034\217vI\303\330(^Tr\206\203\243\212\022O:W\354\'\340\211\256\027\356\214~\240\034\n\000<\262C*4[Nj\260+\241\3677\337\302\266\306\n\325\202.\231A\001\216\242\363k\304\326P\346\227\252\fS\202\311Y^R8\317N\241\225\363*\3053\360\367\274\357\354\306R+\375\223\266[c5p#\321\336\016\323t)\354B\245t\330\335FK\245o\323\373:\002a\271H\300\252s\337\274\223\362,\200\233^\230\034 \300j\035\363\233\274\a%\351Dv\350!\nwY\256\2201f\v\016\024\027Yt\202\246\210\021>\220qF/\361\264\367\254\"J\357F\245c^\244w\t\270a\baDPkX=8;\267\201\277\036[\031\324\203\367\022.i\246\027\325O\235\246\252\260D7g\312\376\223\037\270\021\262\251Viu\241\334\361\205\206\352_\233\rU\250\343\241\363\r\205C\200m@\357\360o\n\210\353\\\342pA\277\376R\366zm\021\312+V\333A\363\205\f\354\332WGl\245\335\273\232\305\255\001\023BF\245\236\001F7\363\224vAn_\205\241\377\233hc5\212Q+#\242_W\234\025\211#\372\203\020\305\372\030\252\034=\255\343\320tA<\006:\250\'\000.\211!\372\305.\034W\274\371\3105h\021Q\206\216\023qG\306\211\271\207\320\334\303\222-\227[\370\217\251,\211\274\245|\307\364\016\350:n\223\347\271\274\243\b\362\026\2775\3128\200\017\323c\3303-3\235U\354\310{\\\233\227t\353A\027\343E\252\315\236\326d\205<\225\017\247@A?\323Q\341\303\226|Uj\355\264\2678UQ\257\023u\220\002\240\215\177\231\a\336\276*\373xr>!\254\331\320PHE\244s\036j\251|-NC\215s];v\277\344X\016KY\305\021+3T\350O\276\265?\376U\361]\250K\272\320D\030W9\025\300\307h\307\017\346\243\335\366fEe\341\353\234l@dB\242\362+\346\246\031\177+p\340\266\372\273d;\206\215f\354\263\264\317J\321?\237Of\372\023|\320\227\304\033\273\352(\207\026\f\334\327\331\350\247\270oZ\364\221\266_\365; <\324~T\345\341\342\001BV\211\222/\342\232\023\\\304tGn\035\223P\\\345\247\037\306\312;\267j\254\022\340\201\306\016N+\232\366\212\223FJ\373@U:fh\v\3027\225\016kS\216\207x^\234\2252\322\206\322 \3728b\347\333\326e\313.\216\322\203-o\355\"=/b\324B\271\267\223\002J\304\230\206+\213\317?\003\350\271\026\t\345(\267\246~\'w^\360\213\034\226~y\021\352\2728\b\024\256\246\2715h!w\302G\017z\357~\300\253T#SJ\300x\2560A\036\375f\233C\003\fW\217\211T6W\367\314@\377\303\031\236\177\021z\376\216x\365]\234\311\367\313\245\017NV\333\265HY\346n\351\3608gP\347ux\335sI\333\350v\020J\311\274\245,\214\326\232\377\302\330\\\300\035\001\367\310\321\355_\346`Lp\251\227\347\323\213\360\245\376\306\206S\223\211\272*%\332S\374v\026p\332H\243 \203\026D\307\240\235X\267Z%\376\30212X\322\025\230\027\240\315\226\033t\027-V\337m$\a\3334\030t\003\370\rEVt\335\210\234 \211\374=\213\232\205\372\370\337\357e\206Y>\t\222"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-CED48DAE6C48->eb5b6878-d6af-4765-9211-7c19367b6298@group-F2C3AB97E722, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571276147648
datanodeUuid: "eb5b6878-d6af-4765-9211-7c19367b6298"
writeChunk {
  blockID {
    containerID: 1571276147648
    localID: 1571276147651
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571276147651.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "b\030\032\302"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-CED48DAE6C48->eb5b6878-d6af-4765-9211-7c19367b6298@group-F2C3AB97E722, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571276147648
datanodeUuid: "eb5b6878-d6af-4765-9211-7c19367b6298"
writeChunk {
  blockID {
    containerID: 1571276147648
    localID: 1571276147651
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571276147651.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "b\030\032\302"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-CED48DAE6C48->eb5b6878-d6af-4765-9211-7c19367b6298 is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


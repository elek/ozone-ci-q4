-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.838 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.769 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1570669560658
datanodeUuid: "d29411f6-44c5-4b62-9326-3820149f5849"
writeChunk {
  blockID {
    containerID: 1570669560658
    localID: 1570669560661
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1570669560661.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000A\333lH"
    }
  }
  data: "q\323\351`\3378\235\216\317\351EKH\026d\236\233\310\231a\272\024~\361S,\242{ \2144,\022\310\373\214\313f\371\234\373\003?\307M\032\nL\333j\315\336/>Ls\341\334\267\241M\204\326\214\227\223\340\257\341/\336\213\207\2032W\200C\257\212,\302\244\005\224K\017\305\036\333v\266\036:W\247\244}\177l\302\t0\201\0054\325\030j!\274\222T\370&v\004\207\301k\217\006=\235\'\' \004@R\300\262\244\240-\247\t\026\276\271Kn;s\276\035\265[p\306\v\336\372?\312\261\362f(\235X\nJ\360\320\225\000\217\254{.\030\2251\251\226\366\331:\340\033\222\223\004\353\315\035\036{\201\203\373<\004>\236%\2167\324\f5\021\345n\262\223\0041\254\224E\034\233w^0\321\353s\262\005\017{ \314\361x\224\220\003\227\312\314\002\3613:xZ\302\273M\200\337\201t\243^\311\234\276\374\363H\253\235t\351\214\242\264R\204\212\324tv\360\246\205\231\2468\027\261\244\354k\262J)\t/\263\370\230\333-\177\224\252\351 \",vA>#\350\315.2\371K\233d\377\355G\370\220\373b\266\241v\226\240\262T\217\300\227Y\241W\274\330*\334\023\256\266)\177\230\215\023V\273t@\017\227\377a\211a\025\207\357Mk\022\355\336\000\352\v\254[5\233r \321\034K\033\367f\263j\rjc\363\r\237\350\0039\rL?@\301\033\006\230\032\246\212b^E-H\\\273\034\350\277\264\002-\211\255\261\020\n\361b\017\030\341\202\231\374\243\276k\"\'\203\362o\361Q\362\354\233\252\251C\304\2169\026\214\"\326i`\343k\200\b\366C\035\303\354\232_\261a\001\225U\316\026\037\273\370\261\253\003\361\035\001\324\340\374K7\362;\231o\227U\265Z\a\260\222\245l\255\313\246P jS\230>\002\370*\200\375\034\222l\265{=\266\033N\353\036\351\020\347f\202\017\230\202\276\202\316S\350\353\203C( \037+\000\326\212\b\241\363\373\272\242\316\024\211\363\316z\347v\202\006AR\322}a\326\310\226\216P\333~-\307i0\026y\257\201>/\a\204\231\241\217\035:\274\005\031\333\036|\027\346\030\354QK\202\237\036iOs\313*\240d\353\314\245\201:\343\325}g\352&\021\340\307\353\346\315\315\263\245\020\355\032\200*\273]\002\274x\351\227\352\204MT\350\353\003c\224\316\210\231\377\3168L\241\215Q\264\016hG\004\365\272\367\357A\240\036\230\374\336R\312cQ\266e\331\322;-XC\271\332\373R\300\365\341\213\215MZJ\351BK\274zH\2265F\234=\312\v\030Dy\235 \a:\324\250\277\234s\247IDC\216\361\327B\244\372?/\273\016J\233\270s\3623\326\374w\217\312\217\253\"w0,\3776u\177\026\320\206@\324\343\327]\342\233R\361+\234\2043\366t\006\201\366\320?\225\364Bc\337\237\242${\204\n\227\262\267\214\334\035*j\252\252\261:e\375+@\325\307:\205 !\314\250\035\322\261iDDb\211\310\323\306\211\316\373\024\204\035\"Nw\033\364AIWJ\311P\a\223\337\026O\0257\r\347FW\243\231\255 \332\232\343\242\000<\207\005-\377\253\272\005H<\2251\2279\232\317\215hW \276\346^\300\277\223\250U\242\245GZY0>\307\343\f\252=\3514\222FE\352\032\274A\244\333\350t:H\260\360K\206\201*\211l\351\2019Gj\254z<J{\3509l\262\237\262\016g\356\262\217\216.8Q\020<\244tdw\357.\265\255\316\253\fp-\244\016H\b\351\353\251i\265\022gm\341\251\206%\206\374H2\314\273U\237\356.Ph\333wNO\302\210\333\000*e\200y\234\"\265\303\236Ln[}q]#\260_\212\301\031\311J"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-501DF6AEC393->d29411f6-44c5-4b62-9326-3820149f5849@group-4539F4DFBC05, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1570669560658
datanodeUuid: "d29411f6-44c5-4b62-9326-3820149f5849"
writeChunk {
  blockID {
    containerID: 1570669560658
    localID: 1570669560661
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1570669560661.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000A\333lH"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-501DF6AEC393->d29411f6-44c5-4b62-9326-3820149f5849@group-4539F4DFBC05, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1570669560658
datanodeUuid: "d29411f6-44c5-4b62-9326-3820149f5849"
writeChunk {
  blockID {
    containerID: 1570669560658
    localID: 1570669560661
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1570669560661.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000A\333lH"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-501DF6AEC393->d29411f6-44c5-4b62-9326-3820149f5849 is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 184.106 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 184.046 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1570486133361
datanodeUuid: "3407e057-8844-4c87-9d29-f73c3cce3712"
writeChunk {
  blockID {
    containerID: 1570486133361
    localID: 1570486133363
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1570486133363.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\316\th9"
    }
  }
  data: "\"\234\301e oK\212\262\217\001\230\177\331\006tp$\302\313\016\270z\by\343\332\3401\341\2432\247\232\366\036\320\347-\310q<\344\3660WL\226\317:\375\037\000\233\366!%\006\212kt\3566QE\a+\274n^m\221\377cGP\360\035M\017\342/%\233{\361\\\037\017\347\030F\005\235\000\242[G\207\351\246\331\256\356\v\\>o7\263\227r\352\352\354$g\033U\214\226\365<\255\"O\302\311.\300\373I;,\326I\305Vcl\256\030\365AO\355t7\000r\335\026\336A%R\201\362&xeo# \202\343\203\201b\357\274\374\265\236`G\032\363\356\342U\236)\024MQ\334l\312zU\006\215\023\261Z\344\205\362\233\233\306\030\376\336\2067\006y#\345\230\312?\205\271\016\003`\024\033,h\026\226\344(U`!\315\307./m\364pv\312\344>\321\006\032\226\342t\307\221\204!\367\202\265\222}T\334\3503\006*\331\322\\\352\023L\345\270\272\352a\313\234\233FF\2172\tV\337r\206\033\001r\377\216\301\340}\250\215\237j\364\357\034lR\315Sz=\a\3748\364\310\212\354^\v7\237r\271L\263\223\241S~\270\361k a\320\332g\342\035\302G \347\247!&,\177w\022/\021\271i\n/\361|\025\001VW\\\355MH\242\327\356U\333\215,:\325\243\210\3746\341(\244\377>\266\244P\202\034a\236\376h\202\357]@\302C\274Kj\370\213\256\257\310\bH\005Z\370BL\024\246\351\346\034\230\375\362 \253\251\245\350\231P\364\t%|\377y\250\367#\217#\022\022Q\313L\234p\235\233\r\005\250@*\357o\"Z TV-L_\265:M\334Vi\370Q\350^PB\222\343T\211\211\332\251\a\365{.}rtS:.\022\206\335\333x\317Y\274\301\227\252\243\b@\252\243\243\006fd\216\273\300\017\243\234:Ic\017\233:\332\342W\t\021rF?\257<vo\323\177.\321\024\203\202PS\a\230\350\370\364\203\356\335[\300\336\233C\267\017\347#\373\232T\205\204JA\355S\264\272M\030ew\327/\273]x\256\272\342{\273\005\251\022\331\356\315j\220\253e,o\210\370%]\247\b\315!1w0/)\261Y\303\233\005`\317\232\373u\362]\272Vn\364\247\364\361Rz@\305J\026\347\3145\330\264>\265\332\020Q\222\016\244\000\020\262\262\331G\305\270\263\034\003T\227\")u\253\376c\320+c\3239;Hb\326\2635\3501\223\333\233\323\304K\376G\213k!@\034H\237q\037l\257>R\247\317V5\255\230\311\273.\336\343f\365\325\344\034;\016\236\360Q\240\276\027hUP\273\377\327q\341[\254y\264\026P\203%\272+\3005ZwV\335\235\2515\372\337\320\032\245\372\230n\335e\323\304!\320\333I;\225$\027p*\332\247\257\214MX\227-\323\324xL\b\343\t\311\322\232!\021\262\270,\314Md:\244T\3059e\357\222P\017\251@\231Y\356\f\240q\200\017\223u\035Un\274\263\253V\a*\272u\236)\337re\354\263\227\3569P\352\303\241\272vN\310\364.\361+\034\b\340k\256\373\255Z\034`C\360\237d\265\233\034\3675\374d\303\303\211\257\001\203\304\343\233\005\200\000\242<\366(\017\337\346\275\0278\201\374\277\372/\276lt4n\355\343\272\357u\327?\231]\314\360\367OS;BR2\035\267}\205Y\253\246g\262\3366C|\263\366a\024-C\265\v\337\r7\201\253\224\354D;\341.\216\323Y\025C\347\346G\301]\177\270\336@\200\260bjr\252\260\000\a\211\206\271\201\223\2420\334\320\3264\2339\215\256pw\236b*\362\004\n\375\367Q\360\247\351\256\365\330\332\036\246\006\027\336\363K\b;\224\215"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-149126A30D92->3407e057-8844-4c87-9d29-f73c3cce3712@group-AD8984935F6D, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1570486133361
datanodeUuid: "3407e057-8844-4c87-9d29-f73c3cce3712"
writeChunk {
  blockID {
    containerID: 1570486133361
    localID: 1570486133363
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1570486133363.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\316\th9"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-149126A30D92->3407e057-8844-4c87-9d29-f73c3cce3712@group-AD8984935F6D, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1570486133361
datanodeUuid: "3407e057-8844-4c87-9d29-f73c3cce3712"
writeChunk {
  blockID {
    containerID: 1570486133361
    localID: 1570486133363
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1570486133363.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\316\th9"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-149126A30D92->3407e057-8844-4c87-9d29-f73c3cce3712 is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


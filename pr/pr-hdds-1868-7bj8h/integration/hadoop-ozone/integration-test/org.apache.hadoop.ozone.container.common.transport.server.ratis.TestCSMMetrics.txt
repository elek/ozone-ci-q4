-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.763 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.694 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571097533706
datanodeUuid: "9fb3b80f-2bab-4628-bd8e-2b1827ec14ca"
writeChunk {
  blockID {
    containerID: 1571097533706
    localID: 1571097533709
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571097533709.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000^\273c\345"
    }
  }
  data: "\231+\2058C\322\310\256\350\346@n\r\314\242 \033s:\027\234\237\036\370d\366u\331J\3573\\\034\203z\003\016~\314\244\256\021\321\337I\027\2179=\027\2301\276\2322Sy\361\n\325\001\241\361,@Z\277h\34391\351\000::\210\2405\001\230\356\215m\246\336\n\"-\222?\366A\276\016\330\334;\315\3407\215)\n4Q\017C\256\324\311\024\024\247L\277\375\340`\332\2076\300.\232\357~OG\346\274G\210\253\202\330\307WP\004\265\240\016=Y\303\263R\033\275\350\245\vl\222x\3506\333\344[@?\207{2s\004\\\217\357y\016.a\334:\002\a\243\027\005\230\274\224B\001\224\206\352b\277F\353\237\330\303\351W\034>\266Gdl\241\233R?\b\366L\310X,\260\273J\200\255t\227-*\016\256\360\346\220\353BT>Q`k\003\215?\214\v\337\2642Z\354\231\315z\030\270 +y}\333\245\361)L\347)\322\377P&B\266\200zp\\\320q\244\332\245\n\312\315{\305\242\340\027\005\342\343#D\333a\321\346U\000\214\301[hfd\276+\372\017\213\312\264\221\251o\352o\270\026\021a*o\226\330kGJ9GaL\360\365\266\337>\300\305*\355\\\341Dr\207\325\341\267+\313\346\347\'\301\364\004\353?>\216\016\235\335G\270\210\301j~O\364\243\224\361\3642\303\277\253A6\250\345\246@\030\311\301p\311}%\032D\361\235=\321XB\255\260\343\255\033\036,k\313\376\0217u*\215\341\321_|/\016\020\v\222D\000\223\215\270\032\334\223\267\371\'\354\302\273\273Kl\266\363\307U\320\363\216b\334\237\016N\236\273;\213.\n\366\247\357\321\035\231\220\213$K\271\261\023nL)\240\221\032T\327\245;,FEm\302\335\024\211G|\233\026\202\024\211.\203|\375\317\317\231\203\034\203y\273o\005\235M\262p_3\266X\b\210\233\022\005\b\322\223\242t\370\315\001\324\376\241\306\210KX\213\3334\264\360\254\021X\t\263\'f\236\261\373\'<,\226ObI<\201\"2\022=\031\021T\254\021\034\255\004\230*\377\274\226z`\273X{\200\336\021\005\347\226\347\017\235a5-:D#F&k\317\205r\354\217\203\267\301{\254\321+A2\361\2666RP\2113\326\267\032\361d\361\362\t\026\365\234\210\314\231\366\205\335\a\203\323\267j\2269\035\347n\244\252\251\371@j\213=\362k\266\216\005\262\n\274\207+\323V[\251f\t\334\310\260\266sc\333\314\024\241\030K{\344,\3559\300Y\322\345\\>\210\027R\032(\250UV\016w\311#j\367B\233`\207\370\202\tC\002\223\310\251S\342\232\213\211\345\314\v`\307s7\321{\a\254\361\022\360!\227\234\340\277\350b\225oP\202\357\213\244J\\kIZ\2177\362\022\246\207\335\022\354$\350B\214 \257\354\241\303r/\207\305%\344\367\vf\230\252\020\vq\005\364>_\345J1\252T\255r\a\337xt\263\345_\305\312\002\204m\022H\270\270\020r\227\250w\204\240B\330Y\346jQ\350\272\266\2627\200\341\204\\\241\261\250\017\333A\342\221\b\363\212O2\306\227R\034\374<\323\367\322\242\205\340\t| \345\307\372L^/\237.oVw\031\322\371#\330\246\200\266\345L\271\343b\313\356R9[R@e%\347P@\253\361\222\322\3312*\n\322(\324\205\315k+\244\233sKp\344\342/\337\207\367\275\340\025S\375\364d\vr\025&=\v[(\313\251l\025\341\350\254t<\314\206z\245\272=fb.n\\*\177\234\250\243.\377U\224\314\253\331#\252\322\000\236\357\205\312\2718\233\367\000\304\207!\016_w\365\234\335\026Z\272\253\370\334\272\034\022M\006\233B\242\262\'\321\221\262\202\320yf\267r"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-401BF29D2429->9fb3b80f-2bab-4628-bd8e-2b1827ec14ca@group-A2B802C83917, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571097533706
datanodeUuid: "9fb3b80f-2bab-4628-bd8e-2b1827ec14ca"
writeChunk {
  blockID {
    containerID: 1571097533706
    localID: 1571097533709
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571097533709.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000^\273c\345"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-401BF29D2429->9fb3b80f-2bab-4628-bd8e-2b1827ec14ca@group-A2B802C83917, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571097533706
datanodeUuid: "9fb3b80f-2bab-4628-bd8e-2b1827ec14ca"
writeChunk {
  blockID {
    containerID: 1571097533706
    localID: 1571097533709
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571097533709.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000^\273c\345"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-401BF29D2429->9fb3b80f-2bab-4628-bd8e-2b1827ec14ca is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


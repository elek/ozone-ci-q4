-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 184.06 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.995 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571425884523
datanodeUuid: "48499f58-95af-4bdc-b749-501d4686550c"
writeChunk {
  blockID {
    containerID: 1571425884523
    localID: 1571425884526
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571425884526.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "w\355\a3"
    }
  }
  data: "(\r\312\375\231\032\357\n/{?\2042\330R\023Q\267\333\377\200\032\027\322A\303pv\273ju=\263\355x\333\3176\234\236\322\304\017o\335G\234\006w\347\021,\374C\vN\203:\302\242\364\252\270\232\305\374\355\327\317\251$*UK\254\317i\207<\aR\261\"\267k\334\374\v[\251\255fWS\246\031=TX\364\216\341\274f\261g\305\351rX,\027\033I\230u\027f\217\363\254\273\bo$\257QePN\216:\310\'\v&R\035\250E\370G-\353\240Tg\372M\2673\256\f{AR;\247\315\374\005\274\r+}\3265\227\231tu@\3406\252{\302\t,\327\337\366\224\bF\321\240\274\244R\275\032\267k\\mn\234\323\026[\245\372\230rr\360`\367\234|\302\240\250\3700\330\332j\320\a\0276\273\227\377\202p\244\321\357\235a\021t~\331\\C7\310\377\2523\353\311\343\267u\t\307\t5Y\225\002(\024\234\346\352\333\224x\346\016\305E\246\245\214\225T\357\217\324\035\376\226\320\205\026\232I\235\275+:\301\266\261\253N\243\216\310\034\203\3560N\022\253\367\314R9\343\026\3133\257\240\305\273%\327\370\337\221\017,c\265\244\026W}\247L\316\243\247\326\241[\365\351\225>\275\345\234\n\027w2@\0350+\330\220\006\r\036\003\300^\326 ~q\270o}*7\251Kxby\216c\270k\212^2\315\351\020d\030\215m;Fi#9\223h\203d\305`k\331V4\213\b\270\375S\021\324\220?\214\351\215\364~Pq\377\365\214\320\306 \001v\243H\256\262\324B}$\021}k\340rM\273O=\203\226vn\2662\326\204C\270l\0271\337\323\253\321\221\025f\3734O\211\367\210\344}N@\223\036/\240\220\202\240\217\246|\274\361A=\003\225\3552\213\273\304\336u\245\330\223p\207UA`\265\320\027\237\365\213\332\306\211;|\301#\306|\026\001\267\321a\335L\232\034\215d\257\177\346\310TN \231\033\244&\234\345\237\031S\247\212}\325\301k\361\306\370\032\211\324\033;\276\364\251\304\246\332\020\317\275\333\326\350\351\310\377\266\212V\300\310\361\266\344\266\254A^w\270\364\211\225\235\027\337A\313\371\317\253z\370\002\323\231\316\002g\374\360\2124\2700\333\274j\223NLF!\235\245\244f\235\325\337D\314>z\242\367\264\264\216\342\324\342\365z\206\313\254Gj\327\372i_t\241\302\"\341TM\262ov,\327\223\222\246\t\\\0207*\204\227\351\325km\030j\224\343\230\367f\030v\261vM3N\215\341\021T\317\tk\320\327\020\326i~\355JL\231\321(\210\266\020A\345\243\235\023T\027\"\347\304L~\271\317\357#W\241\017$\336\232?\313\035n\236\251\026\370E\227\005;\230e\244}\217\311\332\rH\006\002\204\343\371\350\275\023e\325p\213\346\217\370\205\233\275\254\276\250\233\017\025\372gu;n\212\274\033!\351)S\224Q5\224\266\275\t\372M\020x\234\227\nI\222-~h\316\002\034\020\215\314/8\351\240\321\365\031\256\267.i\223@\325v/JI\367\\\031\327\245/\212\334\333\235D\242\212\341\022z\325\316\244\372\305F \217\voT:\301\356A\253\355\r\316^\320\024\316\2248H\367tM\351\321j\211\307 .\030\005\347{\032\246\375\032\355\213\216\346\231\324\\\251_\251\025\021FV\352\364\202\255:\350\263\347\345\200\211i\360\255\326\376\f\350\342Y\351RZ\227q\373\223\372\374|H\374\312I\353#\217V\202H\025}\303\320\377$\246\271\375\220\333\004\2161S\275\351S!\001\224q\347\346\033\002\337\\Oa-L\222\246%F\333\215\2251U>\351\350$\350\354\002R\311\261\033\335\266\257c\036\006\306\301\3428l:9h@&\'\231\320\f&o"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-BDEA377D8777->48499f58-95af-4bdc-b749-501d4686550c@group-B33FF49BC03E, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571425884523
datanodeUuid: "48499f58-95af-4bdc-b749-501d4686550c"
writeChunk {
  blockID {
    containerID: 1571425884523
    localID: 1571425884526
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571425884526.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "w\355\a3"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-BDEA377D8777->48499f58-95af-4bdc-b749-501d4686550c@group-B33FF49BC03E, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571425884523
datanodeUuid: "48499f58-95af-4bdc-b749-501d4686550c"
writeChunk {
  blockID {
    containerID: 1571425884523
    localID: 1571425884526
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571425884526.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "w\355\a3"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-BDEA377D8777->48499f58-95af-4bdc-b749-501d4686550c is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.893 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.828 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571076307083
datanodeUuid: "1af49d8a-7783-4123-9ce9-cd27128ae3a0"
writeChunk {
  blockID {
    containerID: 1571076307083
    localID: 1571076307086
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571076307086.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\216\321\036K"
    }
  }
  data: "d\0248\t\024\333S:\372\310S\240\204\376\317)\370v`\236q\301\333\"\255\207^\352\216c\n\266\267\264\234\307\224\240\233{\224?\251\247\305\373U5\\Mi\320;zNd\237\004\237\211\353wG\250{A\322\207G\334\363\266ct\347j\344N\202\020.\2320\360\216\371\217fe\300\357\370\2554\373-\363FF\314\357\373\223\343\231\230\2030\214\214v\230\324u\237t\245\343\260\344%\272\253\r\210J?*\310\311\356\004\340\207(lj& v\034\370\345\237Y\023\214l\221\214\325\026CF\370}\'\320\236\221\206o\223\205\205a\\\034\217}#\000%&\321(\352\360\234u\265\236\204\244\354\362\3303\244\214\331N\0357\343\017\333Q\333\205\306\217\325\205\360n#\\Y\2301-H\021\264J\217|+\344\020\022\326O`\301XH\364\347\247\264O\235\326\275\3660\234K\235\357r\240\327n\016q_\322}\330\361\247\314\343\211)/\213v\247\336kp\001\001we\343\255\355P\031\355\002\300k*\037\322*\360\006\276\005\365\352\263m\351<\032\207@m\363\016\b\032\242\370<N0\345T\275\267\314\256_%(\225\ae\335@W_g.\340-\277\036\177\243\374eh\301\220h\242\236\320Z\270E\235\234$\325\f\0023\3065\355$\360S\373\360\022\350\201\375\322\341j\215\017\374\306\310\"\227\255\241D\2669-\'\000\001:6\225\364@/\355n\303\275h\246\304\326\302~\236\211\r\300\302\345R\216\313d\224UC\241b\227\322\375\373\253\312\307\021\257j95(,\207\255\350wb=\357\3365-\2301\252~\342b\2172\322\252\330\256\024\275\312\375\252\372$\335w\233\303\345\254{\201\233\267\237\005\237\235\037\354\374\034\004\177\200\n\256w\321\254S*\023\274M.\352r\371\353!T\030\000\222s\344jA\275\361V\236\273\315\305\363\223\315\000\321\310mA2g\325\236\2169\332c\327\255%\256w\352~\037.\020g\347\017\341i\370^\a\352\212\236\277\312J\242\300\343\314\243\233\327\025\227\337\025\216\362\365)\002\360\223\n\364\202\312\025sd\233.\243\271s8\345\2114I\250\370\266\361\357yS\261V*\201\311\224\0032H\245ct\311\325*=,\313\n\003\265\227\367\265\0302\360\240.`\235W\224\361\312K\367}\347\006\336s_\257\201\201![F\367\215\247\023Gz\226\342\377o5\361\337\257\200\355\376\326\032#\006\275J|\261\273_L\037\325\223\217\017\315\022\354\303I\210\274\273\036e\250d\215!\fNJA\370\236x}\220\000\374\3403\031\324\272\bp*\316z9\377\214\373\241\362\234\211\355\353i&i\214\252MV\242\270j\330\330\307\v\037\243\345Pj\373i\240\276\335\322\232\005\020!\002\373\027\376^\n\263\320\240d\246H&\006\206|n\243\301r9\302r\205\\\312\252\302\350\313\367tl\022\301\031z\237\224H\377\244\265\357\000(Ig\360^\276<]2[\371\370\272\026\3009\355\005+`=\326\217\342\312\252\315M\0226t\0263`\251\252\311[k\316\345\241\257\230M\265^\016\370?\265\243\207r9\227\342\304\367\016Q\303\\\310\3567\234\304\245\304\224*\373\260\361\004(\206\rQ\217s\021a\202\331\245Ys\212\004\'\'\277\373st\362\220\220t\320 \351\v\2327cR\r{\r\347\244j\277\304\203\035\377\272\315^\235\377q,{\266=\212%\375W \204\234\020\302\364\270\3733JJ\315\tmf;J\025)\256\315\ae\273c\016\367y\352\034\314\231\n0\2524\211 \252g>{\224\351/\366\204H\026$\351\212u\036\216R\366\230N0P@\257\256\0223(-J\317\\\225\263Z\271X\263\376\277\255\224\266S\305\024\363\315\226\266*\'\331\032\201:\016\a\221x\222\275\220"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-E46048FD67EC->1af49d8a-7783-4123-9ce9-cd27128ae3a0@group-AC692B896D12, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571076307083
datanodeUuid: "1af49d8a-7783-4123-9ce9-cd27128ae3a0"
writeChunk {
  blockID {
    containerID: 1571076307083
    localID: 1571076307086
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571076307086.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\216\321\036K"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-E46048FD67EC->1af49d8a-7783-4123-9ce9-cd27128ae3a0@group-AC692B896D12, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571076307083
datanodeUuid: "1af49d8a-7783-4123-9ce9-cd27128ae3a0"
writeChunk {
  blockID {
    containerID: 1571076307083
    localID: 1571076307086
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571076307086.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\216\321\036K"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-E46048FD67EC->1af49d8a-7783-4123-9ce9-cd27128ae3a0 is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


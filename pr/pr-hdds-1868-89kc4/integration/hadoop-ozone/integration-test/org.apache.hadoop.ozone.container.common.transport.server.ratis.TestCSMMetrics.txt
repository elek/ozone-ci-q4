-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.736 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.674 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571258694585
datanodeUuid: "6ba8b35f-48cb-411a-a83f-39ba82683d08"
writeChunk {
  blockID {
    containerID: 1571258694585
    localID: 1571258694587
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571258694587.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\260\322\337]"
    }
  }
  data: "\314B\tL\272\037\243\025\246V\3010\021\331\004\327g-J\017B\206R\2049N\333\264i\355\221\033\266u&<\'d\260\243\a4s,0\263\331\276\177\364\353\311\0342\3338{+.\364\224,\034\232\221\350\303\333E*\017)M\216\"\274N\025tS\027\306\235\177\373\006V\263\363=\300\321\a\311\337=1\'\'-\314i\255bW\030h*\367\253\207\234\300\261\371[\305.~\363\311\203\271\006\317\371os\201\006a\221\362/\037\3046F\230\v\331\036>\352]\r\250!%=\302\312\232\033\\?\\\377\227%\3762\376\337\366K\322\213\262\277\276JD\321%\323\245k\372?\v$\266\206\366^4u\002l\245\311:\017\3135\231\v[\344\306\242\245\016\2612\b\214\244\342~\373*8\037\207\343\314A\304y\374\202\022Z\342\304\353\240\a\354\226 \226\222\3368\237\ty:\242E\322yE\3142X\304b\263^\000&~\231V\222pT\000K\203\242\253\243\371\030\320\264\241\232\332\322\341\263\263\2532\303\016\215\347\260R\020\037\303G\035\360\001\312\324\211\344\022\366\2063\334\323\203\315\362\366\031\327\272\321\226\204:\235\340S\342\350\271\272\341\'\316zIb\324\257\233\000 \217\3108\233-\017\au\250\247`\215o\305\306\255\220\312l\215\365\016\367\371\223\200 s\203\b\3149\326\250\327\326\352\347/C-0\205\237N\027\357~\223\373:\341\3746l\n\246\252\255\022\0221\363\034\327O\324\035\210\357\334\3232\330\370\374]L}\227\354r<\306\355L(\343\017i\r)\303\364\224o\003\220e\371_\311mm\306e\274:\314\317hn\017\004\253I\372-\222\\\260\377EW0\375\241\317\360\v\260r\032\020\264\220\273e\374\rA\306\220\266\324\260\370\271\351O\332\tn\241\270\345\250P0\237\332\226\37259l\363\372*\300Q\370SH\246\241\367\221\031\203\223\277U\301\261\314\2061\256\264\276\357\035%\336\026\217\372]\266\354\\\320\216\020m3\357\231O\362\225eo\312\374\350\267\226\231w\340\221l\274LS#\304\002G\316!\330\225\001x$\211@\275)\355D\342\325\206\200\003\316\b\372p\177\225?\335U\277\215\323\375\205\351\255F\312\315\377\341\235\271\314\220\367\375\036\334^\371\367:0\r\267\003k/K\333b\330\215\354\303\"\266\nE\020\017\027\'.\022NjPE\034\350j>\210`\031\235H\220\240\363\372\313\326\025\376\254\363(\270G\303\204}w\371><\236;\022p\217XTI\"+*\005\310\266g\026.Lc\206@\3551\t\001N.2\354&\346\217/\331X\317a\215;\330\240\273\231\016.\217^#\301\'\301D\271D\305\342\3110R\237\362\277\001\2601\024}~\242G\370!c\v\327j\241n2\214\212\242P\372\307\361\033iNE*7\361\353k\236\325D\372\214\210V\024\203\241\251\b3n\313`\2401\314\204P\0328-$\025\376`\376\234\rd\360D6\334\243\275i\033\264\312\230\003FaL\f\225\301f\244\017h\373<4\026M\227\346\2050\021W\263RF$xk \306\tA\321\312\2572z\025{KK\245\200*K\226T]\342\370\343\350\372\267\350o\355\225J?7/\337\3511\203\\\'\226c\027\365\352\372\022\343\237x\253\027KP\357>\212\325\305\374\232e\002\251\372\346\036\304\027\356\004\020m\b\0376C\234)\255E\237A\177N\344L^\223\207\205\036\254\363/p\005\223\345\245):@b\262\0246\224\357-\225R\214\330TN[#Z\211\307\203\274\242\223\3621\016z\303VzA\b\372g:\361\177;\3323\277c\206\201O\340W]a?@\266Y\211V\025\336U~?6\017\356\375r\n\200\277|\377\302\'\237p\214\032Zb\033\376\000\234\370))P"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-596B24610197->6ba8b35f-48cb-411a-a83f-39ba82683d08@group-C7F529DD7BDB, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571258694585
datanodeUuid: "6ba8b35f-48cb-411a-a83f-39ba82683d08"
writeChunk {
  blockID {
    containerID: 1571258694585
    localID: 1571258694587
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571258694587.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\260\322\337]"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-596B24610197->6ba8b35f-48cb-411a-a83f-39ba82683d08@group-C7F529DD7BDB, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571258694585
datanodeUuid: "6ba8b35f-48cb-411a-a83f-39ba82683d08"
writeChunk {
  blockID {
    containerID: 1571258694585
    localID: 1571258694587
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571258694587.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\260\322\337]"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-596B24610197->6ba8b35f-48cb-411a-a83f-39ba82683d08 is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


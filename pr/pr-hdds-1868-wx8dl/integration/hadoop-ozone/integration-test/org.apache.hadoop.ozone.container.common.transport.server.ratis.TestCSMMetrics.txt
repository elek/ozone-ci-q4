-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.557 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.49 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571381323315
datanodeUuid: "78211007-056e-47c7-900a-44ec8363d51e"
writeChunk {
  blockID {
    containerID: 1571381323315
    localID: 1571381323318
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571381323318.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "<\244\251\316"
    }
  }
  data: "\215\001H\022\v\375Y+\352\370\370\0302\204\353\327\205\241]i$P\210K\202[v\210\245\224\304\016\231\251\220.\265+nl<\213\276\021\261\353g\356\245\336[\316[K\031\026\036E\204L{\024\035[\005\201$\341\356\271\276\332T$r\377`t\373\377\263w_\331\006!\262\357g\025\2308\024\020\365V\224\230u\022\300\f\004#\256H`\203\016\377\345\316\016\2423\377\302\'\332\247\004X\274\373#1\235_\335\271G~{\263@\223\272\223\022|qj\371\323\'\205\027a\257\300d)\317\252~_~\231\177\276\315-WB2\354\032\254^\"x{\240\353}\v\003\351z\307\363\243\216\237WP$\356\236C!\267\"\323\241\a<82\035q\315\300\000\227\366\030|\27442\3357=\310\377_\222\356\262\"\363\276\242\361\204Lz\263\000\343iA4u\v\266\266x\037\000\275\273d(\030\277Z]\364\2308L\265g; \321^\211\370J*\360\016\227\225\004B\027\306J\220bp\372\367\\xW\3745{\205\202\361\266\322\355\376\316\024-}\233\317\214\201\311\t\343[\037\263\303\200\271\267\332\\\216\003\232%\371\227\316\t\220\322ee\230E\2712\232:eE\352]$I\235\260\000,\246\264\211.\343\263\312B*\321_\213}\220\356\021\326\310\310 J\020\265Dr!\367\334\244pG\300y\366\301ZZ\t\3240\343\316\006\357\225.\276\276\033\214\311\n\3479\214\f\233|.\227\207^\251\277\r\323\305\230kM0\371\212q\272\351\a\377a\031\207f\356\306v*p?4\024\003R\264\'\313\000!2\330\232\240B\017\036f-\024M\260\2416YCO\257R\a\f\330O}\371\221\252\372fh-\356^\304\352O5\322|AR\324w[\335\363%y_G\367\352\231\262\n\214DX\371\2420\314\220\243MV\326&\221\220\000\247\247ZV\224\b\035\316\344\3426~\244c\336\361\t0\275\332\\oY6\226Q\337kT\200\225$\006\227-\363\"\260\221\315\214\'\275uu8\260fR\334\207GF@\006XJB\264\206g!\335Fz x\227\234\v\376\243R\222e\205\300\307r\244;\327d=\215B\333\034\253\366\257\3531\261\235\312\030\002\210{\247\272h\373W\273x\322\261\026\337\212\024%b\367m\035v\247\v\317\255uB\236\273\n\361\314O\a\3247\247\036r\372\206t\337G\2528\241\316v\266\217U\211t\313\277\016R\310\333Q\034(\036\344\242-h\346\277%\331\342\371\323U\365u \347\370\031\002\351Y\t\270\3578M\361\361.a\332\325\001\027\345\260$\017\345T#\374\264\315\332\356\243\224%\b]\017A\362\205\206\024/\025:T\352\254\360\204}\266\006\266 \212\271\244\304wK\346=E\344\234&\305\351-\021\373\270\220\'@m{\2528\234\356\301\354|\303\243G!\003\001Vu\231\306\001\033\342\342\326\344\037<\244y\033K\356+\215x\2719\347\261$\364\307\350\211T\245\207tx\347_G\303\336\n\272\f\256+0v+\037\nn(\342\252E\270\2351\253\0208\202\3311,\356\224\271\316{\356]\365\337\231\202\271\3112\2726\200\332\037\316<\206\317\210\305\236DxV\200\021\244\264\033m\020\t\001\217:.\213\331n\v&\305\336\371\335\371\356\311u?\352\276\326\331$/\236\364z\371\\Ru\270\346\210\374\2278\005cf\261\314\332\220\370q\005\272\231=\375=\372\234\224\235vO\027\021j-\213f\274\300\277gg\354i\026\263U1\216\"\364\362yY\244\241\343\305+\220\024\b\327\316\001:\270\327Y\323\223\323\273\217\207\222\3757j\b\206X&\234s\364r\314\333I{8m\215\b\v1\264\035c\306q\302J\367\260c\365\000\205\026\222bW]\233/iI\210\225\'"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-199F73F0D134->78211007-056e-47c7-900a-44ec8363d51e@group-513A5E482998, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571381323315
datanodeUuid: "78211007-056e-47c7-900a-44ec8363d51e"
writeChunk {
  blockID {
    containerID: 1571381323315
    localID: 1571381323318
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571381323318.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "<\244\251\316"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-199F73F0D134->78211007-056e-47c7-900a-44ec8363d51e@group-513A5E482998, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571381323315
datanodeUuid: "78211007-056e-47c7-900a-44ec8363d51e"
writeChunk {
  blockID {
    containerID: 1571381323315
    localID: 1571381323318
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571381323318.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "<\244\251\316"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-199F73F0D134->78211007-056e-47c7-900a-44ec8363d51e is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


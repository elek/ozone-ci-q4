-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 182.918 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 182.843 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571633139987
datanodeUuid: "3221f562-fad9-4083-83c4-fdb094b0945b"
writeChunk {
  blockID {
    containerID: 1571633139987
    localID: 1571633139989
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571633139989.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\224\252\320\273"
    }
  }
  data: "\006\352\352mV(\372\344\300w\361\016\220\202\264\234Z\264\347s\345\275\001}\356&\034 \3326o\001\313nT\236\357\216\336\302\266\257\274YA\372\250\030\fo\201\354\250\\\336\235\324\260\232\263\304\214g\340\003\217)M\226=.)\204\002\220\035\231\343w*\274t\270gtx\\x\240\301\253W\272\330\275\255\240\345\230\330X\251bo\355w\022\201\242\316PE\346\2308\274\027\225J\375\261\365G\276XL\330\003H=Rm\350N\302\374\210\260D\335\254\325G\207\372\245\345FG\224\032\314w\273\201\001\300\203I\005\327RQ\304\033\203t\220A\254Cq\311!\233?\335\307\177\261\032\016\222\254\371\001\036y\027\322\231Y\333gN%l\323\016}\330\340-\270R\177t\021h\306z\220\2169\375\017P7$\320\005\236=X\027\245\276Ny\366=\227`\240$\205`\002\231\240\350\017\222]\002e\246q)\227\377\2039\316Jt\000M\216W\203Ll)\302\317\243\316T\273\2701\234\223\343\273\273\376\223\344G\311\v\320\343E\277\373C\276\3769\362\357\207\3308\355\251?O{Pl;l\233\001a-\317\032\377\317\246\3118qj\005=FRz\317UJ\b\322fj:\272\250OxkZz\272\177\370\264\270\273F\"\032\362\341\313\370\201\303/GI~\243\367\364@\204\365\300#\364\005K\017\3015\006\001\024\325x\360-U\315\373xsV\030\350\2041\265*\200\326\f\367\301\317:\216j\352FJ9\312\311\030\035G\226\225c\v\261\333o7m\ap}\342\266\035\003/PU\033\257\036\341\315\262\335\242\003\220J1\3175l\333\361N\\yQC\334\346\310j\200\245\332u\312(\033\311\000*m\264\005\030\316\263\032w\311\177\376gHZHj\bW\336\364\320\237n\336\020\000Z\233\n}\0229\267\347\361\343\252\260\310\310\203\246&\225\335{\b\250rR\037\356\370\300r\376,s\336\211g\237\f^\212}0\312\374\245\234#^|\333j\001}w\022\332O/D\304\213\022\353\n\202\365}u)\375V<fH\344\213o\272\262P\342\024G\tTl\343>,\037A_\\\204\375Y\303\'i\274\215\025\t\026L~\227\004N\017[c\206_M\317@\311\213\322\251\212\000\030\336\376\364\035\330i\037\206\034?0\323]NOw\037\034;4\362\271\224/\371\2413{b\324Q\340K\036\264-\342+icx\'2%\351d\360\330\'\236gu\351\224\365\213\345J\343U\212\375\251\316@\201`\266Jq\222\245\032\267e0\305\037\347\177iX\214k\030\021\373Hmc\203.\202\303\356\233\030\377}\266\330\252\321\345\347#\214\r\215\342K\250\215\177\376p\022\324\003OS-\322\b:\355\257\'\340\031\251\202\027M\276|\324\021\355I\252\307\326\364\\\212<r\240\016\020\215\"\303$\233c\362V\362\325\215\246@\r]T\v\231s\203c/xC\346\307h\315s_\216\023s\252\377J\320tf\360\243z \230nAm\257\364v\035\355Q\2024Ug\177c\357\a\257\364\343v\213(5Gz\321u\2051\021IY\023\305\274\336\f<[\373\326W\342C\035&\215\331\357l\004\220\323\255\n\322\271\340\351\005q\315\256\247`\254\2414;!\226\277y\340-\252\334\265}&\022|\241\275\252\2209\370$\031,5\203\312\354\316{\025x\247\030\031C\354\351\306\\\260\342V*@t\303\b\177\017C\246s\233u$L\326\246d\232r\037Q\250\3668\377G\304-\004\315\026\242S\f\021\321\311[\243\022\214\262\375\232\312$\335\364\235\253\244*\"\357uZ\216\211}\264\244]\213M\325\204\376VvZ\207p\316X\017\214\227\273\177Q\033\364\251y^\367\252\264Q\336\354vf vi\3667<d\251\211H\250s"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-F2005BAB87E5->3221f562-fad9-4083-83c4-fdb094b0945b@group-DC093369332C, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571633139987
datanodeUuid: "3221f562-fad9-4083-83c4-fdb094b0945b"
writeChunk {
  blockID {
    containerID: 1571633139987
    localID: 1571633139989
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571633139989.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\224\252\320\273"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-F2005BAB87E5->3221f562-fad9-4083-83c4-fdb094b0945b@group-DC093369332C, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571633139987
datanodeUuid: "3221f562-fad9-4083-83c4-fdb094b0945b"
writeChunk {
  blockID {
    containerID: 1571633139987
    localID: 1571633139989
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571633139989.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\224\252\320\273"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-F2005BAB87E5->3221f562-fad9-4083-83c4-fdb094b0945b is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more


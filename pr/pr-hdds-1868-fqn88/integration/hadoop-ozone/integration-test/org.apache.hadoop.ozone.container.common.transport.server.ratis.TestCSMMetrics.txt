-------------------------------------------------------------------------------
Test set: org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 183.815 s <<< FAILURE! - in org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics
testContainerStateMachineMetrics(org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics)  Time elapsed: 183.749 s  <<< ERROR!
java.io.IOException: 
Failed to command cmdType: WriteChunk
containerID: 1571075969953
datanodeUuid: "0fbe8925-88f0-4128-b5b0-e045fc7bf9cc"
writeChunk {
  blockID {
    containerID: 1571075969953
    localID: 1571075969956
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571075969956.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\261\032S\347"
    }
  }
  data: "[\245\213Q\001\275\354\352\324\2679\330\374K\313\377pr@\243\211\331\272Bq\210\267\247jp\210>\362\311\271re\025q\266|\331X*8\337|\275/Z\366Kiw\'\363^\270\321\256\032\026A\370\2107\021x?\373\'\374\023\274\360\227\361q\223\226@\244\237\250\254\036\325r\036CdO\271\307\354\264\226\001\203\n\030\177\025\317\275\034\301\250\245\'K\036\024>\300)LK\235|^\021\256.\207.C\247)U/\a|\215\266\267Q\376Z\312u\211\212 \365\263\352b\210\221\265\036\276x\241\204\251\2174\265d\227\217\344~\353V\274\330+\230\343\251\026\004\031~\267\335!c\342\030\027RfA.\247\344\303+\374\323U\3163Cz\332\021\213\220\355)e\311\311\035\366[\260%\340$\205$Y\211\215\354\203\333m\272{[{2@\252:\360>\367u\005\322\3617\230?\270\337\330B\335<\257,j/JY\336l\375r9\022\033\274;\200\033\232\t\302\357\3016\307\205\374O\242\314L\207de\263\245\367s\256\367\0175pc\252\r\373\334vl\341yD\274q\247\247\320\364m\204\023O\217\251+!\223\001\201\203k\215i\252\340\030-\370\376\ar\336\377;\347V\326J9fOK\005>\352E\330E\026|nwi\037\262\327\373\300&\302k\322\357Ay\233\016\020\" \323jE^\276UeC\271\227S\206\235@$l\276{\204\022\244\347\233\366[\326\303\317s\345\373i\207\257,c\233\316\225\346\020\016\353yO\265/oN\206{8\330\363\234\252`\202\273\222|\331M\230\217z\265\244\301\241Z\357\220\313\303\036/dg\260\267AE<\367\372\232\360\\\033\006\2763Ib6\373\0016n\226]\"i\343\230\262\373\307\274\337\032e\221\272\212\2736_[\342\a\227\373\306\034\357$/\022\001\206F\ng\031$/\205V\b\310\243\324T\200\263Y\340\262U$9\262\024E\b\210&\213c\004{T?\036\0227eR<}\306pA\016\225\037\345\345\250\t\354\366\333\312\211^\357Z\357\243\"\005g\023\265\202\272\371+\274~\241:\\f\337\317\264,\342X0[\275\367Z\f\334\024\342\246N\313\252&\226\037\250\356\273\355\325\216\346~R\017\354\2738\242\272\271S.k\360\246D\3156W\016\025\023\334\345\330\270\252\374\337\230CMA\0247\f\274\247%\f\177\227\304\030:\335\340\375\334\267\341E*\201\006\355\211\377\206\352b\016>\022q`\221\332d\364\225\216aE\364\354\r\a\253*\216\035\'\367\300\361\244\223-7^\220\r\242\275g\247)\245\030d\231\262\257\267\030\201\306\274mj\aC\222k\021\371\022\026\215R\350\312\006\200\235t\356k\034\033\023O\235q\vU\350R\271\310CiD\346eB\271\217\350\302\211\211\\E\333\347\275\231\367\350I9/J\240\244P\350\222\307\227\260n\311aa\207\316MnJ\225fx#\230\274\r\261\202\235\024\244\2533\021SWa\274x\357\241]\nG\247\206\017\223\245/e\276dn\217d\221\213\236\016e\031\205\334\261\267\373}\260\340\377\331/\\\344\312a\270\266\323\344\2647\315#T9\267*h\235\340\261\370)\335\021/\362\3636E\020\362\250}\001\315Pb\\\205\217\355\025\025X\257z\254\004\n:j\227\240.\336\002\016&\312\231\307\227jZ:\025\207mM\201\316\270\b%dw\267\363$\307n\366\305\320\225\0338R\v\231\345[\210\a\273\376\251\r\367u\361\315\027r_\345\t\326%\005\212x\331\307a\351\341\326\003k\034\337\3554 \325+\b2\206\261\345*\210\254\333\212\242-\356\200Z\242\224\265\223y\340,,C\000.\243\213\347v\371r\000\031S\204F\'\"\353xB\002u\313\037ZvyA\270a\321\310L\231\243\373"
}

	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:113)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.runContainerStateMachineMetrics(TestCSMMetrics.java:141)
	at org.apache.hadoop.ozone.container.common.transport.server.ratis.TestCSMMetrics.testContainerStateMachineMetrics(TestCSMMetrics.java:81)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Caused by: java.util.concurrent.ExecutionException: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-AB5BEEC1D072->0fbe8925-88f0-4128-b5b0-e045fc7bf9cc@group-2849A7B76794, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571075969953
datanodeUuid: "0fbe8925-88f0-4128-b5b0-e045fc7bf9cc"
writeChunk {
  blockID {
    containerID: 1571075969953
    localID: 1571075969956
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571075969956.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\261\032S\347"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
	at org.apache.hadoop.hdds.scm.XceiverClientSpi.sendCommand(XceiverClientSpi.java:110)
	... 27 more
Caused by: org.apache.ratis.protocol.RaftRetryFailureException: Failed RaftClientRequest:client-AB5BEEC1D072->0fbe8925-88f0-4128-b5b0-e045fc7bf9cc@group-2849A7B76794, cid=1, seq=1*, RW, cmdType: WriteChunk
traceID: ""
containerID: 1571075969953
datanodeUuid: "0fbe8925-88f0-4128-b5b0-e045fc7bf9cc"
writeChunk {
  blockID {
    containerID: 1571075969953
    localID: 1571075969956
    blockCommitSequenceId: 0
  }
  chunkData {
    chunkName: "1571075969956.data.0"
    offset: 0
    len: 1024
    checksumData {
      type: CRC32
      bytesPerChecksum: 1048576
      checksums: "\000\000\000\000\261\032S\347"
    }
  }
}
, data.size=1024 for 180 attempts with RetryLimited(maxAttempts=180, sleepTime=1000ms)
	at org.apache.ratis.client.impl.RaftClientImpl.noMoreRetries(RaftClientImpl.java:271)
	at org.apache.ratis.client.impl.OrderedAsync.handleAsyncRetryFailure(OrderedAsync.java:138)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$sendRequest$10(OrderedAsync.java:230)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
	at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:221)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequestWithRetry(OrderedAsync.java:169)
	at org.apache.ratis.util.SlidingWindow$Client.sendOrDelayRequest(SlidingWindow.java:278)
	at org.apache.ratis.util.SlidingWindow$Client.retry(SlidingWindow.java:294)
	at org.apache.ratis.client.impl.OrderedAsync.lambda$scheduleWithTimeout$7(OrderedAsync.java:195)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$0(TimeoutScheduler.java:113)
	at org.apache.ratis.util.TimeoutScheduler.lambda$onTimeout$1(TimeoutScheduler.java:133)
	at org.apache.ratis.util.LogUtils.runAndLog(LogUtils.java:50)
	at org.apache.ratis.util.LogUtils$1.run(LogUtils.java:91)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.ratis.protocol.AlreadyClosedException: client-AB5BEEC1D072->0fbe8925-88f0-4128-b5b0-e045fc7bf9cc is closed.
	at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.onNext(GrpcClientProtocolClient.java:307)
	at org.apache.ratis.grpc.client.GrpcClientRpc.sendRequestAsync(GrpcClientRpc.java:68)
	at org.apache.ratis.client.impl.OrderedAsync.sendRequest(OrderedAsync.java:208)
	... 15 more

